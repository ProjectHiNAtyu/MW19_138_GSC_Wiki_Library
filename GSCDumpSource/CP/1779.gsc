// IW8 GSC SOURCE
// Generated by https://github.com/xensik/gsc-tool

init()
{
    scripts\cp_mp\utility\script_utility::registersharedfunc( "tripwire", "createHintObject", ::tripwire_createhintobject );
    scripts\cp_mp\utility\script_utility::registersharedfunc( "tripwire", "canTripTrap", ::tripwire_cantriptrap );
    scripts\cp_mp\utility\script_utility::registersharedfunc( "tripwire", "damageFunc", ::tripwire_damagefunc );
    scripts\cp_mp\utility\script_utility::registersharedfunc( "tripwire", "disarmGiveWeapon", ::tripwire_disarmgiveweapon );
    scripts\cp_mp\utility\script_utility::registersharedfunc( "tripwire", "blowTripWire", ::_id_12932 );
}

tripwire_createhintobject( var_0, var_1, var_2, var_3, var_4, var_5, var_6, var_7, var_8, var_9, var_10 )
{
    var_11 = spawn( "script_model", var_0 );
    var_11 setmodel( "tag_origin" );
    var_11.angles = ( 0, 0, 0 );

    if ( isdefined( var_5 ) )
        var_11 setuseholdduration( var_5 );
    else
        var_11 setuseholdduration( "duration_medium" );

    if ( !isdefined( var_5 ) || var_5 == "duration_medium" || var_5 == "duration_long" )
        var_11 sethintrequiresholding( 1 );

    if ( isdefined( var_6 ) )
        var_11 sethintonobstruction( var_6 );
    else
        var_11 sethintonobstruction( "hide" );

    if ( isdefined( var_7 ) )
        var_11 sethintdisplayrange( var_7 );
    else
        var_11 sethintdisplayrange( 200 );

    var_11 sethintdisplayfov( 65 );

    if ( isdefined( var_9 ) )
        var_11 setuserange( var_9 );
    else
        var_11 setuserange( 72 );

    if ( isdefined( var_10 ) )
        var_11 setusefov( var_10 );
    else
        var_11 setusefov( 65 );

    thread _id_11F31();
    level thread scripts\cp\cp_weapon::alternate_breach_anim_func( self );
    var_3 = &"CP_STRIKE/DEFUSE";
    var_11 sethintstring( var_3 );
    var_11 setcursorhint( "HINT_BUTTON" );
    var_11 makeusable();
    return var_11;
}

_id_11F31()
{
    self enableplayermarks( "equipment" );
    self waittill( "death" );

    if ( isdefined( self ) )
        self disableplayermarks( "equipment" );
}

tripwire_cantriptrap( var_0, var_1, var_2, var_3, var_4 )
{
    if ( !isdefined( var_0 ) )
        return 0;

    if ( isplayer( var_0 ) && isexplosivedamagemod( var_2 ) && var_3 > 90 )
        return 1;

    if ( isplayer( var_0 ) && rear_minigun_attack_min_cooldown( var_2 ) && var_3 > 10 )
        return 1;

    if ( isplayer( var_0 ) && propminigamescore_compare( var_0, var_1 ) )
        return 1;

    return 0;
}

rear_minigun_attack_min_cooldown( var_0 )
{
    if ( scripts\engine\utility::isbulletdamage( var_0 ) )
        return 1;

    if ( var_0 == "MOD_FIRE" )
        return 1;

    return 0;
}

propminigamescore_compare( var_0, var_1 )
{
    if ( var_1.basename == "emp_drone_player_mp" )
        return 1;

    if ( var_1.basename == "emp_drone_non_player_mp" )
        return 1;

    if ( var_1.basename == "emp_drone_non_player_direct_mp" )
        return 1;

    return 0;
}

tripwire_damagefunc( var_0, var_1 )
{
    var_0 disableplayermarks( "equipment" );

    if ( isdefined( var_1 ) && isplayer( var_1 ) )
        radiusdamage( var_0.origin, 384, 256, 40, undefined, "MOD_SUICIDE", "frag_grenade_mp" );
    else
        radiusdamage( var_0.origin, 384, 256, 40, undefined, "MOD_EXPLOSIVE", "frag_grenade_mp" );

    playrumbleonposition( "grenade_rumble", var_0.origin );
    earthquake( 0.45, 0.7, var_0.origin, 800 );

    if ( isdefined( var_1 ) && isplayer( var_1 ) )
    {
        if ( distancesquared( var_1.origin, var_0.origin ) < 250000 )
            level thread scripts\cp\cp_player_battlechatter::trysaylocalsound( var_1, "flavor_negative", undefined, 1 );
    }
}

tripwire_givegrenade( var_0, var_1 )
{
    var_2 = "power_frag";

    if ( !isstring( var_0 ) )
        var_2 = createheadicon( var_0 );

    switch ( var_2 )
    {
        case "frag":
            var_3 = "power_frag";
            break;
        case "semtex":
            var_3 = "power_semtex";
            break;
        case "c4":
            var_3 = "power_c4";
            break;
        default:
            var_3 = "power_frag";
            break;
    }

    var_4 = 0;

    if ( isdefined( var_1.powers[var_3] ) )
        var_4 = var_1.powers[var_3].charges;

    var_5 = scripts\cp\cp_loadout::get_num_of_charges_for_power( var_1, "primary" );

    if ( var_4 >= var_5 )
        var_4 = var_5 - 1;

    var_1 scripts\cp\cp_powers::givepower( var_3, "primary", undefined, undefined, undefined, 0, 1, var_4 + 1 );
}

tripwire_disarmgiveweapon( var_0, var_1, var_2 )
{
    var_3 = var_0;

    if ( isstring( var_0 ) )
        var_3 = asmdevgetallstates( var_0 );

    if ( hasequipmentoftype( var_0, var_2 ) || obj_leads_spawned_overall( var_2 ) )
        tripwire_givegrenade( var_0, var_2 );

    level thread play_disarm_operator_vo( var_2 );
}

hasequipmentoftype( var_0, var_1 )
{
    var_2 = var_0;

    if ( isstring( var_0 ) )
        var_2 = asmdevgetallstates( var_0 );

    var_3 = var_1.offhandinventory;

    foreach ( var_5 in var_3 )
    {
        if ( getweaponbasename( var_5 ) == getweaponbasename( var_2 ) )
            return 1;

        if ( getweaponbasename( var_2 ) == "frag" && getweaponbasename( var_5 ) == "frag_grenade_mp" )
            return 1;
    }

    return 0;
}

obj_leads_spawned_overall( var_0 )
{
    var_1 = 0;
    var_2 = var_0.offhandinventory;

    foreach ( var_4 in var_2 )
    {
        var_5 = scripts\cp\utility::getequipmenttype( getweaponbasename( var_4 ) );

        if ( isdefined( var_5 ) )
        {
            if ( var_5 == "lethal" )
                var_1 = 1;
        }
    }

    if ( !var_1 )
        return 1;

    return 0;
}

issameoffhandtype( var_0, var_1 )
{
    var_2 = scripts\cp\utility::getequipmenttype( var_0 );

    if ( !isdefined( var_2 ) )
        return 0;

    if ( var_2 == scripts\cp\utility::getequipmenttype( var_1 ) )
        return 1;

    return 0;
}

haslethalequipment( var_0 )
{
    var_1 = var_0.offhandinventory;

    foreach ( var_3 in var_1 )
    {
        var_4 = scripts\cp\utility::getequipmenttype( getweaponbasename( var_3 ) );

        if ( isdefined( var_4 ) && var_4 == "lethal" )
            return 1;
    }

    return 0;
}

play_disarm_operator_vo( var_0 )
{
    if ( !isdefined( level.vo_tripwire_next_callout_time ) || gettime() > level.vo_tripwire_next_callout_time )
    {
        level.vo_tripwire_next_callout_time = gettime() + 30000;
        level thread scripts\cp\cp_player_battlechatter::trysaylocalsound( var_0, "ping_enemy_traps", undefined, 0.8 );
    }
}

_id_12932( var_0, var_1 )
{
    if ( isplayer( var_0 ) && ( var_1 == "MOD_GRENADE_SPLASH" || var_1 == "MOD_PROJECTILE_SPLASH" ) )
        var_0 thread scripts\cp\cp_achievement::trapachievementboom( var_0 );
}
