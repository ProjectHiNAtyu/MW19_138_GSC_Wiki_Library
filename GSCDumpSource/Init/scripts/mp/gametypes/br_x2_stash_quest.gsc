// IW8 GSC SOURCE
// Generated by https://github.com/xensik/gsc-tool

init()
{
    var_0 = scripts\mp\gametypes\br_quest_util.gsc::registerquestcategory( "x2_stash", getdvarint( "scr_br_x2stash_enabled", 1 ) );

    if ( !var_0 )
        return;

    scripts\engine\scriptable::_id_11CDB( "body", ::_id_130A4 );
    scripts\mp\gametypes\br_quest_util.gsc::getquestdata( "x2_stash" )._id_11D1C = getdvarint( "scr_br_x2_stash_searchCircleSize", 3000 );
    scripts\mp\gametypes\br_quest_util.gsc::getquestdata( "x2_stash" ).should_do_vo_call = getdvarint( "scr_br_x2_stash_missionTimeBase", 240 );
    scripts\mp\gametypes\br_quest_util.gsc::registerremovequestinstance( "x2_stash", ::_id_130A7 );
    scripts\mp\gametypes\br_quest_util.gsc::_id_1194E( "x2_stash", ::_id_130A6 );
    scripts\mp\gametypes\br_quest_util.gsc::registerquestthink( "x2_stash", ::_id_130A2, 0.1 );
    scripts\mp\gametypes\br_quest_util.gsc::zvelscale( "x2_stash", ::_id_130A3 );
    scripts\mp\gametypes\br_quest_util.gsc::_id_11950( "x2_stash", ::_id_130A8 );
    scripts\mp\gametypes\br_quest_util.gsc::watch_for_player_going_belowmap_or_oob( "x2_stash", 0 );
    scripts\mp\gametypes\br_quest_util.gsc::_id_11951( "x2_stash", ::_id_130A5 );
}

_id_130A3( var_0 )
{
    if ( !disablespawningforplayer( var_0 ) )
        return;

    var_0 scripts\mp\gametypes\br_quest_util.gsc::uiobjectivehide();
    scripts\mp\gametypes\br_quest_util.gsc::overrideviewkickscaledmr( var_0 );
}

_id_130A8( var_0 )
{
    if ( !disablespawningforplayer( var_0 ) )
        return;

    var_0 scripts\mp\gametypes\br_quest_util.gsc::uiobjectiveshow( "x2_stash" );
    scripts\mp\gametypes\br_quest_util.gsc::_id_12058( var_0 );
}

_id_130A5()
{
    level thread scripts\mp\gametypes\br_public.gsc::cloudanimfx( "mission_gen_fail", self.team, 1 );
}

_id_130A7()
{
    getdomneutralizeomnvarvalue();
    scripts\mp\gametypes\br_quest_util.gsc::releaseteamonquest( self.team );
}

_id_130A6( var_0 )
{
    if ( var_0.team == self.team )
    {
        var_1 = self.playerlist;
        scripts\mp\gametypes\br_quest_util.gsc::getquestinstancedata( "x2_stash", self.team ).playerlist = var_1;

        if ( isdefined( self ) && isdefined( self.damagedisabledfeedback ) && var_1.size )
            self.damagedisabledfeedback setotherent( var_1[0] );

        if ( !scripts\mp\gametypes\br_quest_util.gsc::isteamvalid( var_0.team ) )
        {
            self.result = "fail";
            scripts\mp\gametypes\br_quest_util.gsc::removequestinstance();
        }
    }
}

disablespawningforplayer( var_0 )
{
    return scripts\mp\gametypes\br_gametype_x2.gsc::create_usb_anim_rig( var_0 );
}

monitor_player_near_truck( var_0, var_1, var_2, var_3, var_4 )
{
    var_5 = scripts\mp\gametypes\br_gametype_x2.gsc::create_vault_assault_loadout_selection( "x2_stash", var_0, var_1, var_4 );
    var_5.fulton_interactions_disabled = level._id_1307D;

    if ( level.mapname == "mp_br_mechanics" )
        var_6 = scripts\mp\gametypes\br_quest_util.gsc::getteamcenter( var_0, level.questinfo.defaultfilter );
    else
    {
        var_6 = ( 4460, -1050, -110 );

        if ( var_5.fulton_interactions_disabled == 1 )
            var_6 = ( -1139, 11302, -262 );
        else if ( var_5.fulton_interactions_disabled == 2 )
            var_6 = ( -33933, 4065, -164 );
        else if ( var_5.fulton_interactions_disabled == 3 )
            var_6 = ( -19743, -38579, 1844 );
    }

    var_7 = select_bridge_two_spawners( var_6 );
    var_5._id_11A51 = scripts\mp\gametypes\br_quest_util.gsc::is_point_in_cylinder( "x2_stash", var_7 );
    var_5 _id_1230D( var_5._id_11A51.origin, var_5._id_11A51.angles );
    var_5 scripts\mp\gametypes\br_quest_util.gsc::force_bleedout_all_downed_players( "ui_mp_br_mapmenu_icon_x2_01_objective", "current", var_5._id_11A51.origin );
    var_5 _id_12B3E();
    scripts\mp\gametypes\br_quest_util.gsc::uiobjectiveshowtoteam( "x2_stash", self.team );
    var_5 scripts\mp\gametypes\br_quest_util.gsc::watch_for_player_in_gulag( scripts\mp\gametypes\br_quest_util.gsc::getquestdata( "x2_stash" ).should_do_vo_call, 4 );
    scripts\mp\gametypes\br_quest_util.gsc::addquestinstance( "x2_stash", var_5 );
    scripts\mp\gametypes\br_quest_util.gsc::_id_124A9( "x2_stash", self, self.team );
    var_8 = spawnstruct();
    var_8.vehicleoutline = scripts\mp\gametypes\br_quest_util.gsc::min_z( "x2_stash", scripts\mp\gametypes\br_quest_util.gsc::mine_caves_cell_support_internal( self.team ) );
    scripts\mp\gametypes\br_quest_util.gsc::displayteamsplash( self.team, "br_x2_stash_quest_start_team_notify", var_8 );
    return var_5;
}

bonus_target_score()
{
    return scripts\mp\gametypes\br_gametype_x2.gsc::cp_smuggler_sound_load( "x2_stash", ::monitor_player_near_truck );
}

select_bridge_two_spawners( var_0, var_1 )
{
    var_2 = spawnstruct();
    var_2._id_11D1F = "getUnusedLootCacheArray";
    var_2._id_11D1B = var_0;
    var_2._id_11D22 = 10000;
    var_2._id_11D23 = 1000;
    var_2._id_11D20 = 3000;
    var_2._id_11D21 = 1500;
    var_2._id_11D1D = 1;
    var_2._id_11A51 = var_1;
    var_2.mintime = 60;

    if ( getdvar( "scr_br_gametype", "" ) == "dmz" )
    {
        if ( var_2._id_11D22 < level.watch_for_heli_bosses_dead )
            var_2._id_11D22 = level.watch_for_heli_bosses_dead;

        var_2._id_11D20 = level.watch_for_heli_bosses_dead;
        var_2._id_11D21 = level.watch_for_heli_death;
    }

    return var_2;
}

_id_1230D( var_0, var_1 )
{
    var_2 = spawn( "script_model", var_0 );
    var_3 = self.playerlist[0];
    var_2.angles = var_1;
    var_2 setotherent( var_3 );
    var_2 setmodel( "x1_military_loot_crate_br_01" );
    var_2 setscriptablepartstate( "body", "x1_stash_closed" );
    var_2.watch_for_maze_ai_events = self;
    self.damagedisabledfeedback = var_2;
    var_4 = getlootscriptablearrayinradius( "br_loot_cache" );
    self._id_11B23 = var_4[0];

    foreach ( var_6 in level.players )
    {
        if ( var_6 != var_3 && ( var_3.team == "none" || ( var_6.team != var_3.team || var_6.squadindex != var_3.squadindex ) ) )
            var_2 disablescriptableplayeruse( var_6 );
    }
}

_id_12B3E()
{
    foreach ( var_1 in self.playerlist )
    {
        var_1 scripts\mp\gametypes\br_quest_util.gsc::uiobjectiveshow( "x2_stash" );
        scripts\mp\gametypes\br_quest_util.gsc::_id_12058( var_1 );
    }
}

getnearbyaliveplayer()
{
    var_0 = ( self.damagedisabledfeedback.origin[0], self.damagedisabledfeedback.origin[1], scripts\mp\gametypes\br_quest_util.gsc::getquestdata( "x2_stash" )._id_11D1C );
    var_0 = var_0 + scripts\engine\math::random_vector_2d() * randomfloatrange( 500, 2000 );
    scripts\mp\gametypes\br_quest_util.gsc::spawn_elevators( var_0 );
}

owner_name( var_0 )
{
    scripts\mp\gametypes\br_quest_util.gsc::overtime_music( var_0 );
    var_0 scripts\mp\gametypes\br_quest_util.gsc::uiobjectivehide();
}

getdomneutralizeomnvarvalue()
{
    foreach ( var_1 in self.playerlist )
        owner_name( var_1 );
}

_id_130A4( var_0, var_1, var_2, var_3, var_4 )
{
    if ( var_2 == "x1_stash_closed" && isdefined( var_0.entity ) )
    {
        var_5 = var_0.entity.watch_for_maze_ai_events;

        if ( var_3.team != var_5.team || var_3.squadindex != var_5.squadindex )
        {
            var_3 iprintlnbold( "Chest Requires a Stash Mission" );
            return;
        }

        var_0 setscriptablepartstate( "body", "x1_stash_opening" );
        var_6 = getdvarint( "scr_br_secretstash_cacheDeleteDelay", 30 );
        var_0.entity scripts\engine\utility::delaycallwatchself( var_6, ::delete );
        var_5 scripts\mp\gametypes\br_quest_util.gsc::monitor_player_opens_box_backup( "x2stash", var_3.team, var_0.origin, var_0.angles, var_5._id_11B23 );
        var_5._id_11B21 = var_0.origin;
        var_5._id_11B1E = var_0.angles;
        level notify( "lootcache_opened_kill_callout" + var_0.origin );
        var_7 = level.squaddata[var_3.team][var_3.squadindex].players;

        foreach ( var_9 in var_7 )
            var_9 notify( "calloutmarkerping_warzoneKillQuestIcon" );
    }
}

_id_13096( var_0 )
{
    var_1 = scripts\mp\gametypes\br_gametype_x2.gsc::create_ambient_vehicle( "x2_stash", var_0 );
    var_2 = self.angles;

    if ( !isdefined( self.angles ) )
        var_2 = var_1._id_11B1E;

    var_1 scripts\mp\gametypes\br_quest_util.gsc::monitor_player_opens_box_backup( "x2stash_end", var_0.team, self.origin, var_2, self._id_11B23 );
    scripts\mp\gametypes\br_quest_util.gsc::global_stealth_broken_func( var_0.team, var_0, 8, scripts\mp\gametypes\br_quest_util.gsc::getquestindex( "x2_stash" ) );
    var_1 expiredbydeath( self.playoverwatch_dialogue );
}

expiredbydeath( var_0 )
{
    var_1 = spawnstruct();
    var_2 = scripts\mp\gametypes\br_quest_util.gsc::mine_caves_cell_support_internal( self.team );
    var_3 = scripts\mp\gametypes\br_quest_util.gsc::getquestindex( "x2_stash" );
    var_4 = scripts\mp\gametypes\br_quest_util.gsc::mine_caves_ambush( scripts\mp\gametypes\br_quest_util.gsc::mine_cave_turrets( "x2_stash" ) );
    var_1.target_show_damage_damage_watch = scripts\mp\gametypes\br_quest_util.gsc::target_wavespawning_to_jammer5( var_3, var_2, var_4 );

    if ( getdvarint( "scr_br_x2_contractKillcamFix", 1 ) )
    {
        var_5 = scripts\mp\gametypes\br_gametype_x2.gsc::crate_objectives( self.playerlist );
        scripts\mp\gametypes\br_quest_util.gsc::global_relic_landlocked_func( var_5, "br_x2_stash_quest_complete", var_1 );
    }
    else
        scripts\mp\gametypes\br_quest_util.gsc::displayteamsplash( self.team, "br_x2_stash_quest_complete", var_1 );

    level thread scripts\mp\gametypes\br_public.gsc::brleaderdialog( "mission_scav_success", 1, self.playerlist, undefined, 1, undefined );
    self._id_11B21 = var_0.origin;
    self._id_11B1E = var_0.angles;
    self.result = "success";
    scripts\mp\gametypes\br_quest_util.gsc::removequestinstance();
}

intel_spawn()
{
    getdomneutralizeomnvarvalue();
    self.result = "fail";
    scripts\mp\gametypes\br_quest_util.gsc::removequestinstance();
}

_id_130A2()
{
    var_0 = self;

    if ( istrue( var_0.issnipersemi ) || scripts\mp\flags::gameflag( "x2_ambush" + ( self.fulton_interactions_disabled + 1 ) + "_starting" ) || scripts\mp\flags::gameflag( "x2_train_destroyed" ) )
    {
        var_0 intel_spawn();
        return;
    }
}
