// IW8 GSC SOURCE
// Generated by https://github.com/xensik/gsc-tool

brlootcache_init()
{
    scripts\engine\scriptable::_id_11CDB( "body", ::lootcacheused );
    var_0 = getdvar( "scr_br_debug_loot_name", "" );
    var_1 = getdvar( "scr_br_debug_loot_probability", 0.0 );
    var_2 = strtok( var_0, " " );
    var_3 = strtok( var_1, " " );

    if ( var_3.size == 0 )
        var_3[var_3.size] = "1.0";

    level.codecomputerscriptableused = [];

    for ( var_4 = 0; var_4 < var_2.size; var_4++ )
    {
        var_5 = spawnstruct();
        var_5.name = var_2[var_4];
        var_6 = int( min( var_4, var_3.size - 1 ) );
        var_5.wait_spawn_trucks_smokescreen = float( var_3[var_6] );
        level.codecomputerscriptableused[level.codecomputerscriptableused.size] = var_5;
    }

    if ( istrue( level.ninetypercent_music ) )
    {
        setmatchdata( "halloweenTrickOrTreatRules", 1 );
        _branalytics_addevent::init();
    }
}

delay_put_players_in_black_screen( var_0 )
{
    if ( !isdefined( var_0 ) )
        return 0;

    if ( scripts\mp\gametypes\br_public.gsc::prophasclonesleft() )
    {
        if ( isdefined( level.ispresstofirstspawnmode ) && isdefined( level.ispresstofirstspawnmode[var_0] ) )
            return 0;
    }

    if ( var_0 == "brloot_respawn_token" && scripts\mp\gametypes\br_pickups.gsc::_id_11AB4() )
        return 0;

    return 1;
}

selfrevivemonitorrevivebuttonpressed( var_0, var_1, var_2, var_3, var_4, var_5, var_6 )
{
    if ( istrue( var_4 ) )
    {
        var_7 = 35;

        if ( isdefined( var_6 ) )
        {
            var_8 = [ 115, 75, 95, 85, 105, 65 ];
            var_9 = ( var_1.heli_lookat_monitor + var_6 * 3 ) % var_8.size;
            var_10 = var_8[var_9];
            var_7 = var_7 + 20 * var_6;
        }
        else if ( var_1.heli_lookat_monitor % 2 > 0 )
            var_10 = 75;
        else
            var_10 = 115;

        var_10 = var_10 + randomfloatrange( -10, 10 );
        var_11 = var_7 + var_1.heli_lookat_monitor / 2 * 25 + randomfloatrange( -5, 5 );
        var_12 = scripts\mp\gametypes\br_pickups.gsc::getitemdroporiginandangles( var_1, var_2, var_3, undefined, var_10, var_11 );
    }
    else
        var_12 = scripts\mp\gametypes\br_pickups.gsc::getitemdroporiginandangles( var_1, var_2, var_3 );

    var_13 = level.br_pickups.counts[var_0];
    var_14 = undefined;
    var_15 = scripts\mp\gametypes\br_pickups.gsc::manage_fakebody_hides( var_0 );

    if ( isdefined( var_15 ) )
    {
        var_13 = scripts\mp\gametypes\br_weapons.gsc::br_getweaponstartingclipammo( var_15 );

        if ( scripts\mp\utility\weapon::printcodechosen( var_15 ) )
            var_14 = var_13;
    }

    var_16 = scripts\mp\gametypes\br_pickups.gsc::spawnpickup( var_0, var_12, var_13, 1, undefined, undefined, var_14 );
    var_17 = level.br_pickups.checkrequiredteamstreamcount[var_0];

    if ( var_5 )
        playsoundatpos( var_12.origin, "br_legendary_loot_drop" );

    return var_16;
}

selfrevivethink( var_0, var_1, var_2 )
{
    var_3 = [];
    var_4 = 0;
    var_5 = scripts\mp\gametypes\br_pickups.gsc::playersetattractiontime();
    var_5.heli_lookat_monitor = self.itemsdropped;

    foreach ( var_7 in var_0 )
    {
        if ( delay_put_players_in_black_screen( var_7 ) )
        {
            var_8 = level.br_pickups.checkrequiredteamstreamcount[var_7];

            if ( isdefined( var_8 ) && var_8 == 4 && var_4 == 0 )
            {
                var_3[var_3.size] = selfrevivemonitorrevivebuttonpressed( var_7, var_5, self.origin, self.angles, var_1, 1, var_2 );
                self.itemsdropped++;
                var_4 = 1;
            }
            else
            {
                var_3[var_3.size] = selfrevivemonitorrevivebuttonpressed( var_7, var_5, self.origin, self.angles, var_1, 0, var_2 );
                self.itemsdropped++;
            }
        }
    }

    return var_3;
}

select_bunker_interior_four_spawners( var_0, var_1 )
{
    return selfrevivethink( var_0, 1, var_1 );
}

enemy_mines_init( var_0 )
{
    level endon( "game_ended" );
    self endon( "death" );
    var_1 = getdvarint( "scr_reusable_cache_recharge_time", 90 );
    var_2 = 10;
    var_3 = 1;

    for ( var_4 = var_1 / var_2; var_3 < var_2; var_3++ )
    {
        wait( var_4 );
        self setscriptablepartstate( var_0, "vfx" + var_3 );
    }

    waitframe();
    var_5 = getdvarint( "scr_reusable_cache_loot_sets", 3 );
    self.fxred = ( self.fxred + 1 ) % var_5;
    self setscriptablepartstate( var_0, "closing" );
}

lootcacheused( var_0, var_1, var_2, var_3, var_4 )
{
    if ( istrue( var_3 scripts\mp\gametypes\br_gametypes.gsc::_id_11BE4( "playerSkipLootPickup", var_0 ) ) )
        return;

    if ( isdefined( var_0 ) && isdefined( var_0.delay_spawn_tanks ) && ![[ var_0.delay_spawn_tanks ]]( var_0, var_1, var_2, var_3, var_4 ) )
        return;

    if ( ( var_2 == "closed" || var_2 == "closed_nocol" ) && !isdefined( var_0.entity ) )
    {
        if ( var_2 == "closed" )
            var_0 setscriptablepartstate( var_1, "opening" );
        else if ( var_2 == "closed_nocol" )
            var_0 setscriptablepartstate( var_1, "opening_nocol" );

        if ( isdefined( var_0 ) && isdefined( var_0._id_12B71 ) )
            thread [[ var_0._id_12B71 ]]( var_0, var_1, var_2, var_3, var_4 );

        var_0.itemsdropped = 0;
        thread add_to_score_message( var_0, var_1, var_2, var_3, var_4 );
        scripts\mp\gametypes\br_plunder.gsc::showassassinationtargethud( "br_loot_cache", -1 );
        var_3 thread scripts\mp\utility\points::giveunifiedpoints( "br_cacheOpen" );
        var_3 scripts\cp\helicopter\chopper_boss::stop_hotjoining();

        if ( !isdefined( var_3.select_bunker_courtyard_spawners ) )
            var_3.select_bunker_courtyard_spawners = 1;
        else
            var_3.select_bunker_courtyard_spawners++;

        var_3 scripts\mp\utility\stats::setextrascore1( var_3.select_bunker_courtyard_spawners );

        if ( istrue( level.ninetypercent_music ) )
            var_3 thread _branalytics_addevent::syringe_finish( var_0.type, var_0, var_3.calloutarea );

        level notify( "lootcache_opened_kill_callout" + var_0.origin );
    }
}

add_to_score_message( var_0, var_1, var_2, var_3, var_4 )
{
    var_5 = [];
    var_6 = 0;

    if ( var_0.type == "br_reusable_loot_cache" )
    {
        if ( !isdefined( var_0.fxred ) )
            var_0.fxred = 0;

        var_6 = var_0.fxred;
    }

    if ( isdefined( var_0._id_11CFD ) )
    {
        if ( isdefined( var_0._id_11CFE ) )
            var_7 = verifybunkercode( var_0._id_11CFD, var_0._id_11CFE );
        else
            var_7 = verifybunkercode( var_0._id_11CFD );

        var_7 = scripts\engine\utility::array_randomize( var_7 );
    }
    else
        var_7 = pickscriptablelootitem( var_0, var_6 );

    if ( isdefined( var_7 ) )
        var_7 = select_new_spotlight_goal_node( var_7, var_3 );

    if ( isdefined( var_7 ) && var_3 scripts\mp\utility\perk::_hasperk( "specialty_br_extra_killstreak_chance" ) )
        var_7 = select_patrol_four_spawners( var_7, var_3 );

    var_7 = select_patrol_nine_spawners( var_7, var_3 );

    if ( isdefined( var_7 ) )
    {
        if ( getdvar( "scr_br_gametype", "" ) == "dmz" || getdvar( "scr_br_gametype", "" ) == "risk" )
        {
            if ( scripts\mp\flags::gameflag( "placement_updates_allowed" ) )
            {
                var_8 = game["teamPlacements"][var_3.team];

                if ( !isdefined( level.grenade_exploded_during_stealth_listener ) )
                    scripts\mp\gametypes\br_gametype_dmz.gsc::dangercircleenthidefromplayers();

                var_9 = 100 - 100 * var_8 / level.grenade_exploded_during_stealth_listener;

                if ( isdefined( level.checkbluemassacre ) && var_9 < level.checkbluemassacre )
                    var_7 = select_patrol_eight_spawners( var_0, var_7 );
                else if ( isdefined( level._id_1277D ) && var_9 > level._id_1277D )
                    var_7 = select_patrol_five_spawners( var_0, var_7 );
            }
        }

        if ( isdefined( level.set_wave_num ) )
            var_7 = select_mountain_two_spawners( var_7 );

        if ( var_0.type != "br_reusable_loot_cache" )
            var_6 = undefined;

        if ( var_0.type == "br_loot_cache_zom" )
        {
            if ( isdefined( var_0._id_11CFE ) )
                var_6 = var_0._id_11CFE % 3;

            wait 0.7;
        }

        var_5 = var_0 select_bunker_interior_four_spawners( var_7, var_6 );
    }
    else
    {
        var_10 = ( 0, 0, 0 );
        var_11 = "mp/loot_set_cache_contents_base.csv";

        if ( getdvarint( "scr_br_alt_mode_cash", 0 ) )
            var_11 = "mp/loot_set_cache_contents_base_cash.csv";
        else if ( getdvarint( "scr_br_alt_mode_gg", 0 ) )
            var_11 = "mp/loot_set_cache_contents_base_gg.csv";
        else if ( getdvar( "scr_br_gametype", "" ) == "dmz" || getdvar( "scr_br_gametype", "" ) == "risk" )
        {
            var_10 = ( 0, 45, 0 );

            if ( var_0.type == "br_loot_cache_lege" )
                var_11 = "mp/loot_set_cache_contents_lege_dmz_ground_tablets.csv";
            else if ( var_0.type == "br_loot_cache" )
                var_11 = "mp/loot_set_cache_contents_rare_dmz_ground_tablets.csv";
        }

        var_12 = var_0 chooseandspawnitems( 2, 1, "weapon", var_11, var_10 );
        var_5[var_5.size] = var_12[0];
        var_12 = var_0 chooseandspawnitems( 0, 1, "ammo", var_11, var_10 );
        var_5[var_5.size] = var_12[0];
        var_12 = var_0 chooseandspawnitems( 0, 1, undefined, var_11, var_10 );
        var_5[var_5.size] = var_12[0];
        var_12 = var_0 chooseandspawnitems( 0, 1, undefined, var_11, var_10 );
        var_5[var_5.size] = var_12[0];
        var_12 = var_0 chooseandspawnitems( 2, 1, "plunder", var_11, var_10 );
        var_5[var_5.size] = var_12[0];
        var_0 setscriptablepartstate( var_1, "open" );
    }

    var_13 = "cache";

    switch ( var_0.type )
    {
        case "br_loot_cache_lege":
            var_13 = "cache_legendary";
            break;
        case "br_scavenger_quest_cache":
            var_13 = "cache_scavenger";
            break;
        case "br_geiger_quest_cache":
            var_13 = "cache_geigerstash";
            break;
        case "br_reusable_loot_cache":
            var_0 thread enemy_mines_init( var_1 );
            break;
        case "br_loot_cache_easterevent":
            var_13 = "cache_legendary";
            break;
        case "br_scavenger_quest_cache_adler":
            var_13 = "cache_scavenger";
            break;
        case "br_loot_cache_reddoor":
            var_13 = "cache_legendary";
            break;
        case "br_loot_cache_pow":
            var_13 = "cache_legendary";
            break;
    }

    foreach ( var_15 in var_5 )
    {
        if ( isdefined( var_15 ) )
            var_15.selfrevivebuttonpressed = var_13;
    }
}

select_patrol_eight_spawners( var_0, var_1 )
{
    var_2 = [];

    foreach ( var_4 in var_1 )
    {
        if ( issubstr( var_4, "brloot_plunder" ) )
        {
            if ( var_0.type == "br_loot_cache_lege" )
            {
                if ( var_4 != "brloot_plunder_cash_legendary_1" && scripts\engine\utility::cointoss() )
                    var_4 = "brloot_plunder_cash_legendary_1";
            }
            else if ( var_4 != "brloot_plunder_cash_epic_2" && scripts\engine\utility::cointoss() )
                var_4 = "brloot_plunder_cash_epic_2";
        }

        var_2[var_2.size] = var_4;
    }

    return var_2;
}

select_patrol_five_spawners( var_0, var_1 )
{
    var_2 = [];

    foreach ( var_4 in var_1 )
    {
        if ( issubstr( var_4, "brloot_plunder" ) )
        {
            if ( var_0.type == "br_loot_cache_lege" )
            {
                if ( ( var_4 == "brloot_plunder_cash_epic_2" || var_4 == "brloot_plunder_cash_legendary_1" ) && scripts\engine\utility::cointoss() )
                    var_4 = "brloot_plunder_cash_epic_1";
            }
            else if ( ( var_4 == "brloot_plunder_cash_epic_2" || var_4 == "brloot_plunder_cash_epic_1" ) && scripts\engine\utility::cointoss() )
                var_4 = "brloot_plunder_cash_rare_2";
        }

        var_2[var_2.size] = var_4;
    }

    return var_2;
}

select_mountain_two_spawners( var_0 )
{
    var_1 = [];

    foreach ( var_3 in var_0 )
    {
        if ( var_3 != "brloot_access_card_red" )
        {
            var_1[var_1.size] = var_3;
            continue;
        }

        if ( level.set_wave_num > level.ai_hold_wake_watch )
        {
            var_1[var_1.size] = var_3;
            level.ai_hold_wake_watch++;
        }
    }

    return var_1;
}

chooseandspawnitems( var_0, var_1, var_2, var_3, var_4 )
{
    var_5 = [];
    var_6 = 0;

    if ( !isdefined( var_2 ) )
        var_2 = "";

    if ( !isdefined( var_0 ) )
        var_0 = 0;

    var_7 = "mp/loot_set_cache_contents_base.csv";

    if ( isdefined( var_3 ) )
        var_7 = var_3;

    var_8 = scripts\mp\gametypes\br_pickups.gsc::playersetattractiontime();

    for ( var_9 = 0; var_9 < var_1; var_9++ )
    {
        var_10 = registerscriptedspawnpoints( var_2, var_0, 0, var_7 );

        if ( delay_put_players_in_black_screen( var_10 ) )
        {
            var_11 = self.angles;

            if ( isdefined( var_4 ) )
                var_11 = var_11 + var_4;

            var_12 = level.br_pickups.checkrequiredteamstreamcount[var_10];

            if ( isdefined( var_12 ) && var_12 == 4 && var_6 == 0 )
            {
                var_5[var_5.size] = selfrevivemonitorrevivebuttonpressed( var_10, var_8, self.origin, var_11, undefined, 1 );
                self.itemsdropped++;
                var_6 = 1;
            }
            else
            {
                var_5[var_5.size] = selfrevivemonitorrevivebuttonpressed( var_10, var_8, self.origin, var_11, undefined, 0 );
                self.itemsdropped++;
            }
        }
    }

    return var_5;
}

select_patrol_four_spawners( var_0, var_1 )
{
    if ( !isdefined( var_1.clientmatchdata_logplayerdeath ) )
        var_1.clientmatchdata_logplayerdeath = 10;

    var_2 = 0;

    foreach ( var_5, var_4 in var_0 )
    {
        if ( issubstr( var_4, "killstreak" ) )
        {
            var_2 = 1;
            break;
        }
    }

    if ( !var_2 )
    {
        var_6 = var_1.killcountthislife * 0;

        if ( randomint( 100 ) < var_1.clientmatchdata_logplayerdeath + var_6 )
        {
            var_7 = [ "brloot_killstreak_clusterstrike", "brloot_killstreak_precision_airstrike", "brloot_killstreak_uav" ];
            var_0[var_0.size] = scripts\engine\utility::random( var_7 );
            var_1.clientmatchdata_logplayerdeath = 10;
        }
        else
            var_1.clientmatchdata_logplayerdeath = var_1.clientmatchdata_logplayerdeath + ( var_6 + 15 );
    }

    return var_0;
}

select_new_spotlight_goal_node( var_0, var_1 )
{
    foreach ( var_3 in level.codecomputerscriptableused )
    {
        if ( var_3.wait_spawn_trucks_smokescreen > randomfloat( 1.0 ) )
            var_0[var_0.size] = var_3.name;
    }

    return var_0;
}

select_patrol_nine_spawners( var_0, var_1 )
{
    var_2 = getdvarfloat( "scr_br_plunder_adjust_prob", 0.8 );

    if ( randomfloat( 1.0 ) < var_2 && !recondronemarkedcb( var_0 ) )
    {
        if ( !var_1 _id_1237D() )
            var_0[var_0.size] = "brloot_plunder_cash_uncommon_1";
    }

    return var_0;
}

recondronemarkedcb( var_0 )
{
    foreach ( var_2 in var_0 )
    {
        if ( issubstr( var_2, "brloot_plunder" ) )
            return 1;
    }

    return 0;
}

_id_1237D()
{
    var_0 = self;

    if ( !isalive( var_0 ) )
        return 0;

    var_1 = 0;
    var_2 = 0;
    var_3 = scripts\mp\gametypes\br_public.gsc::minshotstostage3acc( var_0.team, var_0.squadindex );

    foreach ( var_5 in var_3 )
    {
        if ( var_5 scripts\mp\gametypes\br_public.gsc::propminigamefinish() )
        {
            var_2 = 1;
            continue;
        }

        if ( isdefined( var_5.plundercount ) )
            var_1 = var_1 + var_5.plundercount;
    }

    var_7 = level.br_armory_kiosk._id_12697;
    var_8 = var_0 scripts\mp\utility\perk::_hasperk( "specialty_br_cheaper_kiosk" );
    var_9 = level.br_armory_kiosk._id_12698;

    if ( !isdefined( var_9 ) )
        var_9 = 0;

    var_10 = scripts\mp\gametypes\br_armory_kiosk.gsc::actorrope( level.br_armory_kiosk._id_12696, 0, var_7, var_8, var_9 );

    if ( var_2 && isdefined( var_10 ) && var_1 < var_10 )
        return 0;

    return 1;
}
