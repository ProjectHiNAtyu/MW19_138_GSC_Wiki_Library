// IW8 GSC SOURCE
// Generated by https://github.com/xensik/gsc-tool

init()
{
    level.ammobox_giverandomattachment = ::_id_11E99;
    level.ammobox_getbufferedattachmentweapon = ::ammobox_getbufferedattachmentweapon;
    level.endac130infilanimsinternal = ::heli_bravo_main_snd_ent;
    scripts\cp_mp\utility\script_utility::registersharedfunc( "br_juggernaut", "onCrateActivate", ::stop_station_closed_vo );
    scripts\cp_mp\utility\script_utility::registersharedfunc( "br_juggernaut", "onCrateUse", ::stop_turbulence_just_before_the_end );
    scripts\cp_mp\utility\script_utility::registersharedfunc( "br_juggernaut", "onCrateDestroy", ::stop_strafe_minigun_manager );
    level thread scripts\mp\gametypes\br_c130airdrop.gsc::init();
    level.activejuggernauts = [];
    level.client_activate = [];
    thread playerzombiedelayturnonfx();
}

playerzombiedelayturnonfx()
{
    waittillframeend;
    playersetattractionstateindex();
    level.start_area_fx = 0;
}

_id_11E99()
{
    self.takeplayerweaponaway = 100;
    self.taken_damage_for_molotov_achievement = 3.0;
    self.takeriotshield = 1.0;
    self.takerevivepickup = 0.5;
    self.takequesttablet = 5;
    self.infiniteammo = 0;
    self.maxhealth = getdvarint( "scr_br_jugg_health", 2000 );
    self.startinghealth = getdvarint( "scr_br_jugg_health", 2000 );
    self._id_12CFC = int( self.maxhealth / self.setheadicon_removeclientfrommask );
    var_0 = getdvarint( "scr_br_jugg_weapon_pickup", 0 );
    self._id_12BA4 = var_0;
    var_1 = getdvarint( "scr_br_jugg_reload", 1 );

    if ( var_1 )
    {
        self.classstruct.loadoutprimary = "iw8_minigunksjugg_reload_mp";
        self._id_12B94 = var_1;
    }

    self.allows["reload"] = undefined;
}

showdebugresult( var_0 )
{
    var_1 = getdvarfloat( "scr_br_jugg_vs_gas_scale", 7.0 );
    var_2 = var_0 * var_1;
    return int( var_2 );
}

onplayerkilled( var_0, var_1, var_2, var_3, var_4, var_5, var_6, var_7, var_8, var_9 )
{
    if ( isdefined( var_1 ) && isplayer( var_1 ) && var_1 scripts\mp\utility\killstreak::isjuggernaut() )
    {
        var_10 = var_1.health;
        var_11 = int( var_1.maxhealth / 6 );
        var_12 = var_10 + var_11;

        if ( var_12 > var_1.maxhealth )
            var_12 = var_1.maxhealth;

        var_1.health = var_12;
        var_1 notify( "jugg_health_regen" );
    }

    if ( isdefined( self ) && scripts\mp\utility\killstreak::isjuggernaut() )
        self.play_counter_beep_sfx_on_bomb_vests = undefined;
}

ammobox_getbufferedattachmentweapon()
{
    var_0 = self.juggcontext.juggconfig;
    var_1 = getdvarint( "scr_br_jugg_overheat", 0 );

    if ( var_1 )
    {
        thread _id_12F59( var_0 );
        thread _id_12F4E( var_0 );
    }

    thread set_initial_goalradius( var_0 );
}

heli_bravo_main_snd_ent()
{
    var_0 = scripts\mp\gametypes\br_pickups.gsc::playersetattractiontime();
    scripts\mp\gametypes\br_pickups.gsc::heli_check_player_below_starts( var_0 );
    scripts\mp\gametypes\br_pickups.gsc::heli_gunner_logic( var_0 );
    scripts\mp\gametypes\br_pickups.gsc::heli_delayedpadstateupdate( var_0 );
    scripts\mp\gametypes\br_pickups.gsc::heli_extraction( var_0 );
    scripts\mp\gametypes\br_pickups.gsc::heli_fire_at_players( var_0 );
    scripts\mp\gametypes\br_pickups.gsc::heli_intro( var_0 );
    scripts\mp\gametypes\br_pickups.gsc::heli_group_nextspawntime( var_0 );
    scripts\mp\gametypes\br_pickups.gsc::heli_deposit_instruct( var_0 );
    scripts\mp\gametypes\br_pickups.gsc::heli_hover_between_points( var_0 );
    scripts\mp\gametypes\br_pickups.gsc::heliextractwait( var_0 );
}

playersetattractionstateindex()
{
    if ( !isdefined( level.calloutglobals.spawn_script_model_driver_and_passengers ) || level.calloutglobals.spawn_script_model_driver_and_passengers.size == 0 )
        return;

    level.register_vfx = [];

    foreach ( var_3, var_1 in level.calloutglobals.spawn_script_model_driver_and_passengers )
    {
        var_2 = spawnstruct();
        var_2.id = var_3;
        var_2.origin = var_1.origin;
        var_2.occupied = 0;
        level.register_vfx[level.register_vfx.size] = var_2;
    }
}

make_laser_shutdown_interact( var_0 )
{
    var_1 = undefined;

    if ( isdefined( level.register_vfx ) && level.register_vfx.size > 0 )
    {
        foreach ( var_3 in level.register_vfx )
        {
            if ( !isdefined( level._id_11AFA ) )
            {
                if ( !race_countdown_update( var_3, var_0 ) )
                    continue;
            }

            if ( istrue( var_3.occupied ) )
                continue;

            if ( quarry_intro1_chopper( var_3.origin ) )
                continue;

            if ( quarry_hacks_count( var_3.origin ) )
                continue;

            var_1 = var_3;
            var_3.occupied = 1;
            break;
        }

        if ( !isdefined( var_1 ) )
            var_1 = fob();
    }
    else
    {
        var_5 = undefined;
        var_1 = fob( var_5 );
    }

    return var_1;
}

race_countdown_update( var_0, var_1 )
{
    if ( level.br_circle_disabled || !isdefined( level.br_circle ) || level.br_circle.circleindex < 0 )
        return 1;

    var_2 = scripts\mp\gametypes\br_circle.gsc::getsafecircleorigin();
    var_3 = scripts\mp\gametypes\br_circle.gsc::getsafecircleradius();
    var_4 = var_3 + var_1;
    var_5 = var_4 * var_4;

    if ( distance2dsquared( var_0.origin, var_2 ) <= var_5 )
        return 1;

    return 0;
}

quarry_intro1_chopper( var_0 )
{
    var_1 = getdvarint( "scr_br_jugg_min_dist_crate", 20000 );
    var_2 = var_1 * var_1;

    foreach ( var_4 in level.cypher_vo_hack_progress )
    {
        if ( distance2dsquared( var_0, var_4.origin ) < var_2 )
            return 1;
    }

    return 0;
}

quarry_hacks_count( var_0 )
{
    var_1 = scripts\mp\gametypes\br_circle.gsc::getsafecircleradius();
    var_2 = int( var_1 - var_1 / 3 );
    var_3 = var_2 * var_2;

    foreach ( var_5 in level.activejuggernauts )
    {
        if ( isdefined( var_5 ) && distance2dsquared( var_0, var_5.origin ) < var_3 )
            return 1;
    }

    return 0;
}

fob( var_0 )
{
    var_1 = spawnstruct();

    if ( isdefined( var_0 ) )
        var_1.origin = var_0;
    else
    {
        var_2 = 10;

        while ( !isdefined( var_1.origin ) )
        {
            var_3 = scripts\mp\gametypes\br_circle.gsc::mine_caves_waittill_entered();

            if ( isdefined( level.activejuggernauts ) && level.activejuggernauts.size > 0 )
            {
                if ( !quarry_hacks_count( var_3 ) )
                    var_1.origin = var_3;
            }
            else
                var_1.origin = var_3;

            var_2--;

            if ( var_2 == 0 && !isdefined( var_1.origin ) )
                var_1.origin = var_3;

            waitframe();
        }
    }

    return var_1;
}

_id_1203F( var_0, var_1 )
{
    level endon( "game_ended" );
    var_2 = 50000;

    if ( istrue( var_1 ) )
    {
        if ( !istrue( level.br_circle_disabled ) )
            level waittill( "br_circle_set" );
    }
    else
        var_2 = 0;

    var_3 = [];

    for ( var_4 = 0; var_4 < var_0; var_4++ )
    {
        var_5 = make_laser_shutdown_interact( var_2 );
        var_5.brtruck_initfeatures = spawn( "script_model", var_5.origin );
        var_5.brtruck_initfeatures setmodel( "ks_airdrop_crate_br" );
        var_5.brtruck_initfeatures setscriptablepartstate( "jugg_drop_beacon", "on", 0 );
        var_5 scripts\mp\gametypes\br_quest_util.gsc::force_ai_to_drop_thermites( 11, 6, 2, var_5.origin );
        var_5 scripts\mp\gametypes\br_quest_util.gsc::_id_11EBE( 5000 );
        var_5 scripts\mp\gametypes\br_quest_util.gsc::_id_12055();
        var_3[var_3.size] = var_5;
    }

    return var_3;
}

_id_1247C( var_0, var_1 )
{
    level endon( "game_ended" );
    scripts\mp\gametypes\br_gametype_dmz.gsc::_id_1205D( "br_juggdrop_incoming" );

    foreach ( var_4, var_3 in var_0 )
    {
        level thread heli_rpg_enemy_run_away( var_3, var_1 );
        wait( randomfloatrange( 5.0, 10.0 ) );
    }
}

heli_rpg_enemy_run_away( var_0, var_1 )
{
    level endon( "game_ended" );

    if ( !isdefined( var_0.helidrivablethink ) )
        var_0.helidrivablethink = 5000;

    var_2 = scripts\mp\gametypes\br_circle.gsc::mine_caves_vo( var_0.origin, var_0.helidrivablethink );
    var_3 = scripts\mp\gametypes\br_c130airdrop.gsc::custom_putongroundfunc( undefined, var_2, 1 );
    var_4 = distance( var_3.startpt, var_3.endpt );
    var_5 = scripts\mp\gametypes\br_c130.gsc::getc130speed();
    var_6 = var_4 / var_5;
    var_7 = scripts\mp\gametypes\br_c130airdrop.gsc::cypher_iconid( var_3, var_4, var_5, var_6 );
    var_7.heli_starts_addstart = ::heli_starts_addstart;
    var_7._id_1217E = var_1;
    var_7 scripts\mp\gametypes\br_c130airdrop.gsc::cypher_id_pool( 1, "battle_royale_juggernaut", "jugg_world", var_0 );
}

heli_starts_addstart( var_0, var_1, var_2, var_3 )
{
    var_4 = self.startpt;
    var_5 = self.centerpt;
    var_6 = self.speed;
    var_7 = distance2d( var_4, var_5 ) / var_6;
    var_8 = 0;
    var_9 = 0;

    for ( level.start_area_fx = level.start_area_fx + var_0; var_8 < var_0; var_12._id_12B9F = make_combat_icon_on_ai() )
    {
        wait( var_7 );
        var_10 = scripts\mp\gametypes\br_c130airdrop.gsc::customturret( self.origin, 1 );
        var_11 = scripts\cp_mp\killstreaks\airdrop::heli_convertforplayerfunc( var_10 + ( 0, 0, level.cyber_bot_pickup_emp - 100 ), var_10, self.angles, var_1, var_2, var_3.spawnprojectile );
        var_8++;
        var_11.heli_landing_volumes = var_3;
        var_11._id_1217E = self._id_1217E;
        level.cypher_vo_hack_progress[level.cypher_vo_hack_progress.size] = var_11;
        var_12 = scripts\cp_mp\killstreaks\airdrop::gettriggerobject( var_11 );
    }
}

_id_12F59( var_0 )
{
    self endon( "death_or_disconnect" );
    self endon( "juggernaut_end" );
    level endon( "game_ended" );
    var_1 = var_0.takeplayerweaponaway;
    var_2 = var_0.taken_damage_for_molotov_achievement;
    var_0.oldlatespawnplayer = 0;

    for (;;)
    {
        self waittill( "weapon_fired" );
        var_0.oldlatespawnplayer++;
        var_0.resettimeronpickup = gettime();

        if ( var_0.oldlatespawnplayer >= var_1 )
        {
            iprintlnbold( "OVERHEAT" );
            scripts\common\utility::allow_fire( 0 );
            wait( var_2 );
            iprintlnbold( "COOLDOWN" );
            scripts\common\utility::allow_fire( 1 );
        }
    }
}

_id_12F4E( var_0 )
{
    self endon( "death_or_disconnect" );
    self endon( "juggernaut_end" );
    level endon( "game_ended" );
    var_1 = var_0.takeriotshield;
    var_2 = var_0.takerevivepickup;
    var_3 = var_0.takequesttablet;

    for (;;)
    {
        if ( var_0.oldlatespawnplayer > 0 && gettime() - var_0.resettimeronpickup >= var_1 * 1000 )
        {
            var_4 = var_0.oldlatespawnplayer - var_2;

            if ( var_4 < 0 )
                var_4 = 0;

            var_0.oldlatespawnplayer = int( var_4 );
        }

        wait 0.05;
    }
}

set_initial_goalradius( var_0 )
{
    self endon( "death_or_disconnect" );
    self endon( "juggernaut_end" );
    level endon( "game_ended" );
    var_1 = 5;

    for (;;)
    {
        var_2 = scripts\engine\utility::_id_12E47( "deaths_door_enter", "jugg_health_regen" );
        var_3 = 1;

        if ( var_2 == "deaths_door_enter" )
        {
            var_3 = 0;
            self.play_counter_beep_sfx_on_bomb_vests = 1;
            wait( var_1 );
        }
        else if ( var_2 == "jugg_health_regen" )
        {
            var_4 = self.health / self.maxhealth;

            if ( var_4 >= 0.75 )
            {
                if ( istrue( self.play_counter_beep_sfx_on_bomb_vests ) )
                    self.play_counter_beep_sfx_on_bomb_vests = undefined;
            }
        }

        scripts\mp\healthoverlay::onexitdeathsdoor( var_3 );
    }
}

droponplayerdeath( var_0 )
{
    scripts\mp\gametypes\br_gametypes.gsc::_id_11BE4( "onJuggDropOnDeath", var_0 );
    level.start_area_fx--;
}

heli_starts_clear()
{
    var_0 = scripts\engine\trace::create_contents( 0, 1, 1, 1, 0, 0, 1, 1, 1 );
    var_1 = scripts\engine\trace::ray_trace( self.origin + ( 0, 0, 40 ), self.origin - ( 0, 0, 10000 ), self, var_0 );
    var_2 = self.origin;

    if ( isdefined( var_1 ) && isdefined( var_1["hittype"] ) && var_1["hittype"] != "hittype_none" )
        var_2 = var_1["position"];

    var_3 = scripts\cp_mp\killstreaks\airdrop::heli_convertforplayerfunc( self.origin + ( 0, 0, 10 ), var_2, self.angles, "battle_royale_juggernaut", "jugg_world" );

    if ( isdefined( var_3 ) )
    {
        var_4 = scripts\cp_mp\killstreaks\airdrop::gettriggerobject( var_3 );
        var_4._id_12B9F = make_combat_icon_on_ai();
    }
}

stop_station_closed_vo( var_0 )
{
    scripts\mp\gametypes\br_gametypes.gsc::_id_11BE4( "onJuggCrateActivate", var_0 );

    if ( istrue( var_0 ) )
    {
        thread _id_12F1C();
        thread _id_12F1B();
    }
}

_id_12F1C()
{
    self endon( "death" );
    var_0 = getdvarint( "scr_br_jugg_crate_lifetime", 300 );
    wait( var_0 );
    scripts\cp_mp\killstreaks\airdrop::destroycrate();
}

_id_12F1B()
{
    self endon( "death" );

    if ( istrue( level.br_circle_disabled ) )
        return;

    var_0 = getdvarint( "scr_br_jugg_crate_gas_lifetime", 30 );

    for (;;)
    {
        wait 0.05;

        if ( !isdefined( level.br_circle ) || level.br_circle.circleindex < 0 )
            continue;

        var_1 = scripts\mp\gametypes\br_circle.gsc::getdangercircleorigin();
        var_2 = scripts\mp\gametypes\br_circle.gsc::getdangercircleradius();

        if ( distance2dsquared( var_1, self.origin ) > var_2 * var_2 )
            break;
    }

    wait( var_0 );
    scripts\cp_mp\killstreaks\airdrop::destroycrate();
}

stop_turbulence_just_before_the_end( var_0 )
{
    var_0.register_seat_data_for_vehicle = self._id_1217E;
    scripts\mp\gametypes\br_gametypes.gsc::_id_11BE4( "onJuggCrateUse", var_0 );
    spectatekey( var_0 );
    filtervehiclespawnstructsfunc();
}

spectatekey( var_0 )
{
    var_1 = self.origin;
    var_2 = 5000;
    var_3 = scripts\common\utility::playersincylinder( var_1, var_2 );

    foreach ( var_5 in var_3 )
    {
        if ( isdefined( var_5 ) && scripts\mp\utility\player::isreallyalive( var_5 ) && var_5 != var_0 )
        {
            var_6 = "br_jugg_capture_positive";

            if ( var_5.team != var_0.team )
                var_6 = "br_jugg_capture_negative";

            var_5 playlocalsound( var_6 );
        }
    }
}

stop_strafe_minigun_manager( var_0 )
{
    scripts\mp\gametypes\br_gametypes.gsc::_id_11BE4( "onJuggCrateDestroy", var_0 );
    level.start_area_fx--;
    filtervehiclespawnstructsfunc();
}

filtervehiclespawnstructsfunc()
{
    if ( isdefined( self.heli_landing_volumes ) )
    {
        self.heli_landing_volumes.occupied = 0;

        if ( isdefined( self.heli_landing_volumes.mapcircle ) )
            self.heli_landing_volumes scripts\mp\gametypes\br_quest_util.gsc::getclosestplayerforreward();

        if ( isdefined( self.heli_landing_volumes.brtruck_initfeatures ) )
        {
            self.heli_landing_volumes.brtruck_initfeatures setscriptablepartstate( "jugg_drop_beacon", "off" );
            self.heli_landing_volumes.brtruck_initfeatures delete();
        }
    }

    if ( isdefined( level.cypher_vo_hack_progress ) )
        level.cypher_vo_hack_progress = scripts\engine\utility::array_remove( level.cypher_vo_hack_progress, self );
}

player_choppergunnericon( var_0, var_1, var_2 )
{
    if ( !isdefined( var_2 ) )
        var_2 = "default";

    if ( !isdefined( level.client_activate[var_2] ) )
        level.client_activate[var_2] = [];

    level.client_activate[var_2][var_0] = var_1;
}

lastdirtyscore( var_0, var_1 )
{
    var_2 = undefined;

    if ( isdefined( var_1 ) )
    {
        if ( isdefined( level.client_activate[var_1] ) )
            var_2 = level.client_activate[var_1][var_0];
    }

    if ( !isdefined( var_2 ) )
        var_2 = level.client_activate["default"][var_0];

    return var_2;
}

make_combat_icon_on_ai()
{
    return getdvarfloat( "scr_br_jugg_crate_use_time", 5 );
}

maxbetarank()
{
    return getdvarint( "scr_br_jugg_num_drops", 3 );
}

maphint_offerscriptableused()
{
    return getdvarfloat( "scr_br_jugg_vs_jugg_scale", 1.0 );
}

matchdata_recordrecentlyplayeddata()
{
    return getdvarfloat( "scr_br_jugg_minigun_scale", 1.25 );
}
