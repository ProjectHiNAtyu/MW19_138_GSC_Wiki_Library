// IW8 GSC SOURCE
// Generated by https://github.com/xensik/gsc-tool

init()
{
    var_0 = isdefined( level.modifyplayerdamage ) && level.modifyplayerdamage == scripts\mp\gametypes\br.gsc::brmodifyplayerdamage;

    if ( var_0 )
    {
        level.modifyplayerdamage = ::cop_car_initdamage;
        level._id_120C3 = getdvarint( "scr_skydiveSpawnProtection", 1 ) == 1;
        level._id_120C5 = getdvarfloat( "scr_skydiveSpawnProtectionModifier", 0.1 );
        level._id_120C2 = getdvarfloat( "scr_skydiveSpawnLauncherDamage", 0.1 );
        level._id_120C9 = getdvarint( "scr_skydiveSpawnProtectionScaleHeightTop", 800 );
        level._id_120C8 = getdvarint( "scr_skydiveSpawnProtectionScaleHeightBottom", 50 );
        level._id_120C7 = getdvarfloat( "scr_skydiveSpawnProtectionModifierTop", 0.1 );
        level._id_120C6 = getdvarfloat( "scr_skydiveSpawnProtectionModifierBottom", 0.9 );
    }
}

playerzombieemp( var_0 )
{
    if ( !istrue( level._id_120C3 ) )
        return;

    thread coop_handle_invuln_ac130();
    thread coop_escort_get_vehicle_driver_hint_string_func();
    thread cooldownsec();

    if ( var_0 )
        thread coop_escort_try_start_driving_func();
    else
        self._id_120C5 = level._id_120C5;
}

coop_escort_get_vehicle_driver_hint_string_func()
{
    self endon( "death_or_disconnect" );
    self endon( "skydive_remove_spawn_protection" );
    self._id_120C3 = 1;

    while ( !self isonground() )
        waitframe();

    self._id_120C3 = undefined;
    self notify( "skydive_remove_spawn_protection" );
}

cooldownsec()
{
    self endon( "death_or_disconnect" );
    self endon( "skydive_remove_launcher_protection" );
    self._id_120C1 = 1;

    while ( !self isonground() )
        waitframe();

    self._id_120C1 = undefined;
    self notify( "skydive_remove_launcher_protection" );
}

coop_handle_invuln_ac130()
{
    self endon( "death_or_disconnect" );
    self endon( "skydive_remove_spawn_protection" );
    self._id_120C3 = 1;
    self waittill( "weapon_fired" );
    self._id_120C3 = undefined;
    self notify( "skydive_remove_spawn_protection" );
}

coop_escort_try_start_driving_func()
{
    self endon( "death_or_disconnect" );
    self endon( "skydive_remove_spawn_protection" );
    self._id_120C4 = 1;
    self._id_120C5 = 1;

    while ( istrue( self._id_120C3 ) )
    {
        var_0 = scripts\mp\gametypes\br_public.gsc::helihint_deposit( self.origin, 0, -100000 );
        var_1 = self.origin[2] - var_0[2];
        var_2 = level._id_120C9 - level._id_120C8;
        self._id_120C4 = clamp( var_1 / var_2, 0, 1 );
        var_3 = level._id_120C7 - level._id_120C6;
        self._id_120C5 = self._id_120C4 * var_3 + level._id_120C6;
        waitframe();
    }

    self._id_120C5 = undefined;
}

cop_car_initdamage( var_0, var_1, var_2, var_3, var_4, var_5, var_6, var_7, var_8, var_9, var_10 )
{
    if ( istrue( level._id_120C3 ) )
    {
        if ( istrue( var_1._id_120C3 ) && isdefined( self._id_120C5 ) )
            var_3 = var_3 * self._id_120C5;

        if ( isdefined( var_2 ) && istrue( var_2._id_120C1 ) )
        {
            switch ( var_4 )
            {
                case "MOD_EXPLOSIVE":
                case "MOD_GRENADE_SPLASH":
                case "MOD_GRENADE":
                case "MOD_PROJECTILE_SPLASH":
                    var_3 = var_3 * level._id_120C2;
                    break;
            }
        }
    }

    var_3 = scripts\mp\gametypes\br.gsc::brmodifyplayerdamage( var_0, var_1, var_2, var_3, var_4, var_5, var_6, var_7, var_8, var_9, var_10 );
    return var_3;
}
