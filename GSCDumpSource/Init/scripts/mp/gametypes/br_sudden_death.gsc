// IW8 GSC SOURCE
// Generated by https://github.com/xensik/gsc-tool

init()
{
    level.cleanupswaploadoutflags._id_12572 = [];
    level.cleanupswaploadoutflags._id_12576 = getdvarint( "scr_br_sd_countdown", 15 );
    level.cleanupswaploadoutflags._id_12574 = getdvarint( "scr_br_sd_circle_delay", 0 );
    level.cleanupswaploadoutflags._id_12575 = getdvarint( "scr_br_sd_circle_index", 3 );
    level.cleanupswaploadoutflags._id_12573 = getdvarint( "scr_br_sd_circle_close", 1 );
    scripts\mp\flags::gameflaginit( "sudden_death_started", 0 );
    scripts\mp\flags::gameflaginit( "sudden_death_complete", 0 );
}

start( var_0 )
{
    activate_control_station_interaction();
    scripts\mp\flags::gameflagset( "sudden_death_started" );
    addpostlaunchspawns();
    activate_pressure_sensor( var_0 );
    thread addvehicularmanslaughtercharge( var_0 );
    level waittill( "sudden_death_spawns_finished" );
    thread adjust_player_pos_memory_array_size( var_0 );
    wait( level.cleanupswaploadoutflags._id_12574 + level.cleanupswaploadoutflags._id_12573 );
    actorid();
    activate_precision_use_lua();
    addlaststandoverheadiconcallback();
    level.disablespawning = 1;
    scripts\mp\flags::gameflagwait( "sudden_death_complete" );
    return level.cleanupswaploadoutflags._id_12572["losing_team"];
}

activate_control_station_interaction()
{
    scripts\mp\gametypes\br_gametypes.gsc::_id_12A5C( "playerKilledSpawn" );

    if ( scripts\mp\gametypes\br_gametypes.gsc::propsetclonesleft( "oneLife" ) )
    {
        level.disablespawning = 1;
        setdynamicdvar( "scr_" + scripts\mp\utility\game::getgametype() + "_numLives", 1 );
    }

    level.ondeadevent = ::addaliasarraytoqueue;
}

addpostlaunchspawns()
{
    foreach ( var_1 in level.players )
        var_1 scripts\mp\gametypes\br_public.gsc::usb_right();
}

activate_pressure_sensor( var_0 )
{
    if ( isdefined( var_0.enable_lbravo_player_infil ) )
        [[ var_0.enable_lbravo_player_infil ]]( var_0._id_122E0 );
}

addvehicularmanslaughtercharge( var_0 )
{
    foreach ( var_2 in level.players )
    {
        var_2 notify( "sudden_death_started" );
        var_3 = var_2 [[ var_0._id_122E9 ]]( var_0._id_122E0 );
        var_2 thread addupperrighthudelem( var_3 );
    }

    wait 2;
    level notify( "sudden_death_spawns_finished" );
}

addupperrighthudelem( var_0 )
{
    self endon( "disconnect" );
    self._id_11AA7 = 1;
    self.plotarmor = 1;
    self.forcespawnorigin = var_0.origin;
    self.forcespawnangles = var_0.angles;
    scripts\mp\playerlogic::spawnplayer( 0 );

    if ( istrue( self.checkpointstruct ) )
        scripts\mp\gametypes\br.gsc::_id_12A58( self );

    waitframe();
    scripts\mp\outofbounds::clearoob( self );
    scripts\mp\gametypes\br_armor.gsc::monitor_truck( 1 );
    scripts\mp\gametypes\br_weapons.gsc::checkforsubgametypeoverrides();
    self._id_11AA7 = undefined;
}

actorid()
{
    foreach ( var_1 in level.players )
        var_1 scripts\mp\playerlogic::playerprematchallow( 0 );
}

addlaststandoverheadiconcallback()
{
    foreach ( var_1 in level.players )
    {
        var_1 thread scripts\mp\gametypes\br.gsc::checkpoint_fx_play();
        var_1 scripts\mp\playerlogic::playerprematchallow( 1 );
        var_1.plotarmor = undefined;
        var_1 setclientomnvar( "ui_match_start_countdown", 0 );
        var_1 setclientomnvar( "ui_match_in_progress", 1 );
        var_1 thread va_standard_spawnpoint_valid();
    }
}

activate_precision_use_lua()
{
    level scripts\mp\gamelogic::livelobbymatchstarttimer( "match_starting_in", level.cleanupswaploadoutflags._id_12576 );
}

va_standard_spawnpoint_valid()
{
    self endon( "disconnect" );
    self setclientomnvar( "ui_objective_text", 0 );
    wait 5;
    self setclientomnvar( "ui_objective_text", -1 );
}

adjust_player_pos_memory_array_size( var_0 )
{
    level endon( "game_ended" );
    var_1 = var_0.dropoff_point_spawner;
    scripts\mp\gametypes\br_circle.gsc::players_in_correct_volume( var_1, level.cleanupswaploadoutflags._id_12574, level.cleanupswaploadoutflags._id_12575, level.cleanupswaploadoutflags._id_12573, level.cleanupswaploadoutflags._id_12576 );
}

addaliasarraytoqueue( var_0 )
{
    scripts\mp\gamelogic::default_ondeadevent( var_0 );
    activate_scavenger_bag( var_0 );
}

activate_scavenger_bag( var_0 )
{
    level.cleanupswaploadoutflags._id_12572["losing_team"] = var_0;
    scripts\mp\flags::gameflagset( "sudden_death_complete" );
}
