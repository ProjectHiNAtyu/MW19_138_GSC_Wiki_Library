// IW8 GSC SOURCE
// Generated by https://github.com/xensik/gsc-tool

init()
{
    if ( scripts\mp\utility\game::getgametype() != "br" )
        return;

    zombiepingrate( "br_mastery_fiveContracts", ::isattachmentselectfire );
    zombiepingrate( "br_mastery_pointBlank_airstrike", ::vehiclespawn_armoredtruck );
    zombiepingrate( "br_mastery_pointBlank_tomahawk", ::vehiclespawn_cargotruckmg );
    zombiepingrate( "br_mastery_c4VehicleMultKill", ::damage_shield_reduction );
    zombiepingrate( "br_mastery_ghostRideWhip", ::modular_spawning_vehicles );
    zombiepingrate( "br_mastery_roundKillExecute", ::_id_11B9D );
    zombiepingrate( "br_mastery_travelogue", ::_id_12876 );
}

zombiepingrate( var_0, var_1 )
{
    if ( !isdefined( level.checkpoint_add_spawnpoint ) )
        level.checkpoint_add_spawnpoint = [];

    level.checkpoint_add_spawnpoint[var_0] = var_1;
}

dialog_wait_ready( var_0, var_1 )
{
    if ( !isdefined( level.checkpoint_add_spawnpoint ) )
        return;

    if ( istrue( level.dialogueindex ) )
        return;

    var_2 = level.checkpoint_add_spawnpoint[var_0];

    if ( isdefined( var_2 ) )
        self thread [[ var_2 ]]( var_0, var_1 );
}

brgetloadoutoptionforname( var_0 )
{
    if ( getdvarint( "scr_br_challenge_debug", 0 ) )
        iprintlnbold( "Mastery Challenge: " + var_0 + " completed!" );

    scripts\cp\helicopter\chopper_boss::stop_passedby_once( var_0 );
}

set_strict_ff( var_0 )
{
    if ( !isdefined( level.teamdata[var_0] ) )
        return;

    foreach ( var_2 in level.teamdata[var_0]["players"] )
        _id_12875( var_2 );

    if ( getdvarint( "scr_br_core_trios_or_quads", 0 ) )
    {
        _id_12AA1( var_0 );
        spawn_weapons_by_player_count( var_0 );
    }
}

_id_12AA1( var_0 )
{
    if ( !isdefined( var_0 ) )
        return;

    var_1 = 0;
    var_2 = 0;
    var_3 = max( 1, level.maxteamsize );

    foreach ( var_5 in level.teamdata[var_0]["players"] )
    {
        var_1 = var_1 + var_5.deaths;

        if ( isdefined( var_5.setup_techo_lmgs ) )
            var_1 = var_1 + var_5.setup_techo_lmgs;

        if ( scripts\mp\utility\player::isreallyalive( var_5 ) )
            var_2++;
    }

    if ( var_1 == 0 )
    {
        foreach ( var_5 in level.teamdata[var_0]["players"] )
            var_5 brgetloadoutoptionforname( "br_mastery_untouchable" );
    }
}

spawn_weapon_box_cache()
{
    if ( !isdefined( self ) || !isdefined( self.team ) )
        return;

    var_0 = self.deaths;
    var_1 = self.team;

    foreach ( var_3 in level.teamdata[var_1]["players"] )
    {
        if ( scripts\mp\utility\player::isreallyalive( var_3 ) )
        {
            if ( !isdefined( var_3.setup_techo_lmgs ) )
                var_3.setup_techo_lmgs = 0;

            var_3.setup_techo_lmgs = var_3.setup_techo_lmgs + var_0;
            break;
        }
    }
}

spawn_weapons_by_player_count( var_0 )
{
    var_1 = 7;

    if ( !isdefined( var_0 ) )
        return;

    var_2 = 0;

    foreach ( var_4 in level.teamdata[var_0]["players"] )
    {
        var_2 = var_2 + var_4.deaths;

        if ( isdefined( var_4.setup_techo_lmgs ) )
            var_2 = var_2 + var_4.setup_techo_lmgs;
    }

    if ( var_2 >= var_1 )
    {
        foreach ( var_4 in level.teamdata[var_0]["players"] )
            var_4 brgetloadoutoptionforname( "br_mastery_neverSayDie" );
    }
}

isattachmentselectfire( var_0, var_1 )
{
    if ( !isdefined( self.team ) )
        return;

    if ( scripts\mp\gametypes\br.gsc::get_int_or_0( self.collbrush ) < 5 )
        return;

    var_2 = isdefined( level.gulag ) && !istrue( level.gulag.shutdown );

    foreach ( var_4 in level.teamdata[self.team]["players"] )
    {
        if ( !scripts\mp\utility\player::isreallyalive( var_4 ) )
            return;

        if ( var_2 && var_4 scripts\mp\gametypes\br_public.gsc::questtypes() )
            return;
    }

    brgetloadoutoptionforname( var_0 );
}

vehiclespawn_armoredtruck( var_0, var_1 )
{
    var_2 = var_1.trap_array;
    var_3 = var_1._id_1266B;

    if ( !isdefined( var_2 ) || !isdefined( var_2.battle_tracks_settogglestate ) || !isdefined( var_2.streakinfo ) || !isdefined( var_3 ) )
        return;

    var_4 = var_2.streakinfo;

    if ( distancesquared( self.origin, var_3 ) > squared( 432 ) )
        return;

    self endon( "death_or_disconnect" );
    self notify( "pointBlank_airstrike_killtracker" );
    self endon( "pointBlank_airstrike_killtracker" );
    scripts\engine\utility::_id_12E53( 10.0, "airstrike_finished_" + var_2.battle_tracks_settogglestate );

    if ( !scripts\mp\utility\player::isreallyalive( self ) )
        return;

    if ( var_4.kills >= 3 )
        brgetloadoutoptionforname( "br_mastery_pointBlankStreakKill" );
}

vehiclespawn_cargotruckmg( var_0, var_1 )
{
    var_2 = var_1.streakinfo;
    var_3 = var_1._id_1266B;

    if ( !isdefined( var_2 ) )
        return;

    if ( !isdefined( var_3 ) )
        return;

    if ( distancesquared( self.origin, var_3 ) > squared( 432 ) )
        return;

    self endon( "death_or_disconnect" );
    self notify( "pointBlank_tomahawk_killtracker" );
    self endon( "pointBlank_tomahawk_killtracker" );
    scripts\engine\utility::_id_12E54( 20, "cluster_strike_finished" );

    if ( !scripts\mp\utility\player::isreallyalive( self ) )
        return;

    if ( var_2.kills >= 3 )
        brgetloadoutoptionforname( "br_mastery_pointBlankStreakKill" );

    return;
}

damage_shield_reduction( var_0, var_1 )
{
    var_2 = var_1.meansofdeath;
    var_3 = var_1.inflictor;

    if ( !isdefined( var_2 ) || var_2 != "MOD_EXPLOSIVE" )
        return;

    if ( !rear_spotlight_max_dist_sq_from_node( var_3 ) )
        return;

    self endon( "disconnect" );
    level endon( "game_ended" );
    self notify( "updateC4VehicleMultKill" );
    self endon( "updateC4VehicleMultKill" );

    if ( !isdefined( self.withinprojectiondistance ) )
        self.withinprojectiondistance = 0;

    self.withinprojectiondistance++;
    wait 4.0;

    if ( isdefined( self.withinprojectiondistance ) && self.withinprojectiondistance >= 3 )
    {
        brgetloadoutoptionforname( var_0 );
        var_4 = damage_players_when_enter_trigger( var_3 );
        var_5 = isdefined( var_4 ) && isdefined( var_4.team ) && isdefined( self.team ) && var_4.team == self.team;

        if ( var_5 )
            var_4 brgetloadoutoptionforname( var_0 );
    }

    self.withinprojectiondistance = undefined;
}

rear_spotlight_max_dist_sq_from_node( var_0 )
{
    if ( !isdefined( var_0 ) )
        return 0;

    if ( isdefined( var_0.vehiclename ) && !var_0 scripts\common\vehicle_code::vehicle_is_stopped() )
    {
        var_1 = var_0 getlinkedchildren();

        foreach ( var_3 in var_1 )
        {
            if ( isdefined( var_3.weapon_name ) && var_3.weapon_name == "c4_mp_p" )
                return 1;
        }
    }
    else if ( isdefined( var_0.weapon_name ) && var_0.weapon_name == "c4_mp_p" )
    {
        var_5 = var_0 getlinkedparent();

        if ( isdefined( var_5 ) && isdefined( var_5.vehiclename ) && !var_5 scripts\common\vehicle_code::vehicle_is_stopped() )
            return 1;
    }

    return 0;
}

damage_players_when_enter_trigger( var_0 )
{
    if ( isdefined( var_0 ) && isdefined( var_0.weapon_name ) && var_0.weapon_name == "c4_mp_p" )
    {
        var_1 = var_0 getlinkedparent();

        if ( isdefined( var_1 ) )
            return var_1.owner;
    }

    return undefined;
}

_id_11B9D( var_0, var_1 )
{
    var_2 = var_1.player;

    if ( !isdefined( var_2 ) )
        return;

    if ( isdefined( var_2.modifiers["execution"] ) && var_2.modifiers["execution"] == 1 )
        var_2 brgetloadoutoptionforname( "br_mastery_roundKillExecute" );
}

modular_spawning_vehicles( var_0, var_1 )
{
    self endon( "disconnect" );
    level endon( "game_ended" );

    if ( !isdefined( self ) )
        return;

    var_2 = var_1.init_silo_jump_obj;
    var_3 = var_1.seq3_puzzle_attempts;

    if ( istrue( var_2 ) )
    {
        if ( istrue( self.obj_hangar_juggs ) && self.woods_one_death_func != 0 )
            return;

        self.obj_hangar_juggs = 1;
    }

    if ( !istrue( self.obj_hangar_juggs ) )
        return;

    self notify( "ghostRideWhip" );
    self endon( "ghostRideWhip" );

    if ( !isdefined( self.woods_one_death_func ) )
        self.woods_one_death_func = 0;

    if ( istrue( var_3 ) )
        self.woods_one_death_func++;

    wait 4.0;

    if ( !isdefined( self ) )
        return;

    if ( isdefined( self.woods_one_death_func ) && self.woods_one_death_func >= 3 )
        brgetloadoutoptionforname( var_0 );

    self.woods_one_death_func = undefined;
    self.obj_hangar_juggs = undefined;
}

_id_12876( var_0, var_1 )
{
    var_2 = -1;

    if ( getdvarint( "scr_br_core_trios_or_quads", 0 ) == 0 )
        return;

    var_3 = var_1.inflictor;

    if ( !isdefined( var_3 ) )
        return;

    if ( !isplayer( var_3 ) && isdefined( var_3.owner ) && isplayer( var_3.owner ) )
        var_3 = var_3.owner;
    else
        return;

    var_4 = var_1.victim;

    if ( !isdefined( var_4 ) || !isplayer( var_4 ) )
        return;

    var_5 = 0;
    var_6 = var_3 scripts\mp\gametypes\br_callouts.gsc::markingcoldblooded( var_3 );

    if ( var_6 != var_2 )
        var_5 = var_5 | 1 << var_6;

    var_6 = var_4 scripts\mp\gametypes\br_callouts.gsc::markingcoldblooded( var_4 );

    if ( var_6 != var_2 )
        var_5 = var_5 | 1 << var_6;

    if ( var_5 == 0 )
        return;

    foreach ( var_8 in level.teamdata[var_3.team]["players"] )
    {
        if ( !isdefined( var_8._id_1315A ) )
            var_8._id_1315A = 0;

        var_8._id_1315A = var_8._id_1315A | var_5;
    }
}

_id_12875( var_0 )
{
    var_1 = 12;

    if ( !isdefined( var_0._id_1315A ) || var_0._id_1315A == 0 )
        return;

    var_2 = 0;

    for ( var_3 = 0; var_3 < level.calloutglobals.spawn_script_model_driver_and_passengers.size; var_3++ )
    {
        var_4 = var_0._id_1315A & 1 << var_3;

        if ( var_4 )
            var_2++;
    }

    if ( var_2 >= var_1 )
        var_0 brgetloadoutoptionforname( "br_mastery_travelogue" );

    return;
}
