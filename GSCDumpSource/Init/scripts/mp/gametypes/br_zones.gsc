// IW8 GSC SOURCE
// Generated by https://github.com/xensik/gsc-tool

init()
{
    level.chopperexfil_sh050_start = spawnstruct();
    level.chopperexfil_sh050_start.types = [];
    playerplunderevent( "plague", 1, ::_id_1314E, ::_id_13151, ::_id_13149, ::_id_1314A, ::transitionac130tomovinganim, ::_id_13150 );
    playerplundereventcallbacks( "plague", 1, 9, 0 );
    level.chopperexfil_sh050_start.zones = [];
    level.chopperexfil_sh050_start.spawnboardroom_specialist = 0;
    thread player_respawn_struct( "scr_br_plague_zone_locations", "", "prematch_done" );
}

playerplunderevent( var_0, var_1, var_2, var_3, var_4, var_5, var_6, var_7 )
{
    var_8 = spawnstruct();
    var_8.name = var_0;
    var_8.mp_deadzone_patch = var_1;
    var_8.playersetkeypadcodelengthindex = var_2;
    var_8._id_1206A = var_3;
    var_8.infil_light_dvars = var_4;
    var_8.init_silo_platforms = var_5;
    var_8.is_current_solution_correct = var_6;
    var_8.spawn_cypher_monitor_model = var_7;
    var_8._id_12798 = [];
    level.chopperexfil_sh050_start.types[var_0] = var_8;
}

playerplundereventcallbacks( var_0, var_1, var_2, var_3 )
{
    var_4 = spawnstruct();
    var_4.color = var_1;
    var_4.icon = var_2;
    var_4.style = var_3;
    level.chopperexfil_sh050_start.types[var_0].mapcircle = var_4;
}

longdeathtracker( var_0 )
{
    return level.chopperexfil_sh050_start.zones[var_0];
}

_id_12278( var_0, var_1, var_2 )
{
    if ( !isdefined( level.chopperexfil_sh050_start.types[var_0] ) )
        return;

    var_3 = level.chopperexfil_sh050_start.types[var_0];
    var_4 = spawnstruct();
    var_4.type = var_0;
    var_4._id_12798 = [];
    var_4.moving = 0;
    var_5 = ( var_1[0], var_1[1], var_2 );

    if ( isdefined( var_3.mapcircle ) )
    {
        var_6 = var_3.mapcircle.color;
        var_7 = var_3.mapcircle.icon;
        var_8 = var_3.mapcircle.style;
        var_4 scripts\mp\gametypes\br_quest_util.gsc::force_ai_to_drop_thermites( var_6, var_7, var_8, var_5 );
        var_4.mapcircle show();
    }
    else
        var_4 scripts\mp\gametypes\br_quest_util.gsc::force_ai_to_drop_thermites( 0, 0, 0, var_5 );

    var_4.id = "zone_" + level.chopperexfil_sh050_start.spawnboardroom_specialist;
    level.chopperexfil_sh050_start.spawnboardroom_specialist++;
    var_4 thread [[ var_3.playersetkeypadcodelengthindex ]]();
    level.chopperexfil_sh050_start.zones[var_4.id] = var_4;
    var_4 _id_12279( var_1, var_2 );
    return var_4.id;
}

_id_12279( var_0, var_1 )
{
    if ( isdefined( self.trigger ) )
        self.trigger delete();

    self.trigger = spawn( "trigger_radius", ( var_0[0], var_0[1], -2000 ), 0, int( var_1 ), 12000 );
    thread _id_13153();
}

_id_13148()
{
    var_0 = level.chopperexfil_sh050_start.types[self.type];
    self thread [[ var_0._id_1206A ]]();
    self.trigger delete();
    self.mapcircle delete();
    self notify( "delete" );
    level.chopperexfil_sh050_start.zones[self.id] = undefined;
}

_id_13153()
{
    self.trigger endon( "death" );
    var_0 = level.chopperexfil_sh050_start.types[self.type];

    for (;;)
    {
        self.trigger waittill( "trigger", var_1 );

        if ( !isplayer( var_1 ) )
            continue;

        if ( self.moving )
        {
            var_2 = _id_1314C();
            var_3 = _id_1314D();
            var_3 = var_3 * var_3;

            if ( distance2dsquared( var_1.origin, var_2 ) > var_3 )
                continue;
        }

        if ( isdefined( var_0.is_current_solution_correct ) && [[ var_0.is_current_solution_correct ]]( var_1 ) )
            continue;

        var_4 = var_1.guid;

        if ( !isdefined( self._id_12798[var_4] ) )
        {
            var_5 = spawnstruct();
            var_5.player = var_1;
            var_5.start = gettime();
            var_6 = 0;

            if ( var_0.mp_deadzone_patch )
            {
                self._id_12798[var_4] = spawnstruct();

                if ( !isdefined( var_0._id_12798[var_4] ) )
                {
                    var_5.x1opsnpcweaponbarrelmodel = 0;
                    var_0._id_12798[var_4] = var_5;
                    var_6 = 1;
                }

                var_0._id_12798[var_4].x1opsnpcweaponbarrelmodel++;
            }
            else
            {
                if ( !isdefined( var_0._id_12798[var_4] ) )
                    var_0._id_12798[var_4] = 0;

                var_0._id_12798[var_4]++;
                self._id_12798[var_4] = var_5;
                var_6 = 1;
            }

            if ( var_6 )
                self thread [[ var_0.infil_light_dvars ]]( var_5 );
        }

        thread ai_extra_think( var_4 );
    }
}

ai_extra_think( var_0 )
{
    var_1 = self._id_12798[var_0];
    var_1 notify( "trigger_exit" );
    var_1 endon( "trigger_exit" );
    waitframe();
    waittillframeend;
    var_2 = level.chopperexfil_sh050_start.types[self.type];
    self._id_12798[var_0] = undefined;
    var_3 = 0;

    if ( var_2.mp_deadzone_patch )
    {
        var_2._id_12798[var_0].x1opsnpcweaponbarrelmodel--;

        if ( !var_2._id_12798[var_0].x1opsnpcweaponbarrelmodel )
        {
            var_1 = var_2._id_12798[var_0];
            var_2._id_12798[var_0] = undefined;
            var_3 = 1;
        }
    }
    else
    {
        var_2._id_12798[var_0]--;

        if ( !var_2._id_12798[var_0] )
            var_2._id_12798[var_0] = undefined;

        var_3 = 1;
    }

    if ( var_3 )
        self thread [[ var_2.init_silo_platforms ]]( var_1 );
}

_id_1314F( var_0, var_1, var_2 )
{
    self notify( "move" );
    self endon( "move" );
    self endon( "delete" );
    var_3 = _id_1314C();

    if ( !isdefined( var_0 ) )
        var_0 = var_3;

    var_4 = _id_1314D();

    if ( !isdefined( var_1 ) )
        var_1 = var_4;

    if ( !isdefined( var_2 ) )
        var_2 = 0;

    var_5 = level.chopperexfil_sh050_start.types[self.type];

    if ( isdefined( var_5.spawn_cypher_monitor_model ) )
        self thread [[ var_5.spawn_cypher_monitor_model ]]( var_0, var_1, var_2 );

    var_6 = var_3 != var_0 || var_4 != var_1;

    if ( var_6 )
    {
        var_7 = ( var_0[0], var_0[1], var_1 );

        if ( var_2 <= 0 )
            self.mapcircle.origin = var_7 _id_12279( var_0, var_1 );
        else
        {
            self.moving = 1;

            if ( var_4 < var_1 )
                _id_12279( var_0, var_1 );

            self.mapcircle moveto( var_7, var_2 );
            childthread ai_excluder();
            wait( var_2 );

            if ( var_4 > var_1 )
                _id_12279( var_0, var_1 );
        }
    }
    else
    {

    }

    self.moving = 0;
}

ai_excluder()
{
    self.trigger endon( "death" );

    for (;;)
    {
        var_0 = _id_1314C();
        self.trigger.origin = ( var_0[0], var_0[1], -2000 );
        waitframe();
    }
}

_id_1314C()
{
    return ( self.mapcircle.origin[0], self.mapcircle.origin[1], 0 );
}

_id_1314D()
{
    return self.mapcircle.origin[2];
}

init_minigun_lifetime_shot_count( var_0 )
{
    return var_0 scripts\mp\gametypes\br_public.gsc::questtypes();
}

init_nuke_vault_oil_puddles( var_0 )
{
    return var_0 scripts\mp\gametypes\br_public.gsc::update_timer_for_bomb_vest_detonator_holder();
}

_id_1314E()
{
    var_0 = loadfx( "vfx/iw8_br/gameplay/corruptzone/vfx_corruptzone_spores_10k" );
    self.transition_to_next_section = spawnfx( var_0, _id_1314C() );
    self.transition_to_next_section forcenetfieldhighlod( 1 );
    triggerfx( self.transition_to_next_section );
}

_id_13151()
{
    if ( isdefined( self.transition_to_next_section ) )
        self.transition_to_next_section delete();
}

_id_13149( var_0 )
{
    if ( !var_0.player scripts\mp\gametypes\br_public.gsc::update_timer_for_bomb_vest_detonator_holder() )
    {
        var_0.player scripts\cp_mp\utility\game_utility::_visionsetnakedforplayer( "mp_don3_plague", 0.5 );
        thread _id_13155( var_0 );
        thread _id_13156( var_0 );
    }

    var_0.player setscriptablepartstate( "plague_zone", "enter" );
}

_id_13155( var_0 )
{
    var_1 = getdvarint( "scr_br_zones_plague_damage", 3 );
    var_2 = getdvarfloat( "scr_br_zones_plague_jugg_damage_scale", 7.0 );
    var_3 = getdvarfloat( "scr_br_zones_plague_damage_rate", 2 );
    var_4 = getdvarint( "scr_br_zones_plague_cough", 0 );
    var_0 endon( "end_plague_update" );
    var_0.player endon( "disconnect" );

    for (;;)
    {
        var_5 = var_0.player;

        if ( scripts\cp_mp\gasmask::hasgasmask( var_5 ) )
            var_5 scripts\cp_mp\gasmask::processdamage( var_1 );
        else
        {
            var_6 = var_1;

            if ( isdefined( level.showdebugresult ) )
                var_6 = var_5 [[ level.showdebugresult ]]( var_6 );

            if ( var_5 scripts\mp\utility\killstreak::isjuggernaut() )
                var_6 = int( var_6 * var_2 );

            var_5 dodamage( var_6, var_5.origin, var_5, undefined, "MOD_TRIGGER_HURT", "danger_circle_br" );

            if ( var_5 scripts\mp\gametypes\br_public.gsc::hasarmor() )
                var_5 scripts\mp\gametypes\br_public.gsc::damagearmor( var_6 );

            if ( var_4 )
                var_5 scripts\mp\gametypes\br_circle.gsc::_id_12972();
        }

        wait( var_3 );
    }
}

_id_13156( var_0 )
{
    var_0 endon( "end_plague_update" );
    var_0.player endon( "disconnect" );

    for (;;)
    {
        if ( scripts\cp_mp\gasmask::hasgasmask( var_0.player ) )
            var_0.player scripts\mp\gametypes\br_pickups.gsc::kiosk_spent_total( "plague_zone" );

        wait 1;
    }
}

_id_1314A( var_0 )
{
    var_0 notify( "end_plague_update" );

    if ( !isdefined( var_0.player ) )
        return;

    var_0.player setscriptablepartstate( "plague_zone", "exit" );

    if ( !var_0.player scripts\mp\gametypes\br_public.gsc::update_timer_for_bomb_vest_detonator_holder() )
    {
        if ( scripts\cp_mp\gasmask::hasgasmask( var_0.player ) )
            var_0.player scripts\mp\gametypes\br_pickups.gsc::kingslayerkills( "plague_zone" );

        var_0.player scripts\cp_mp\utility\game_utility::_visionsetnakedforplayer( "", 0.5 );
    }
}

_id_13150( var_0, var_1, var_2 )
{

}

player_respawn_struct( var_0, var_1, var_2 )
{
    var_3 = getdvar( var_0, var_1 );

    if ( var_3 == "" )
        return;

    waittillframeend;

    if ( isdefined( var_2 ) )
        scripts\mp\flags::gameflagwait( var_2 );

    var_4 = getdvarint( "scr_br_plague_zone_locations_max", -1 );
    var_5 = strtok( var_3, "," );

    if ( var_4 < 0 )
        var_4 = var_5.size;
    else
    {
        var_4 = min( var_4, var_5.size );
        var_5 = scripts\engine\utility::array_randomize( var_5 );
    }

    for ( var_6 = 0; var_6 < var_4; var_6++ )
    {
        var_7 = var_5[var_6];
        player_respawn( var_7 );
        thread _id_11BD0( var_7 );
    }
}

_id_11BD0( var_0 )
{
    var_1 = level.chopperexfil_sh050_start.spawn_rpgs_for_players[var_0];

    if ( !isdefined( var_1 ) )
        return;

    if ( var_1.get_valid_starting_station_name_on_track > var_1.get_valid_seats )
        var_2 = randomfloatrange( var_1.get_valid_seats, var_1.get_valid_starting_station_name_on_track );
    else
        var_2 = var_1.get_valid_seats;

    wait( var_2 );

    if ( var_1.mp_emporium_hanging_crates > 0 )
    {
        var_3 = _id_12278( "plague", var_1.origin, 50 );
        var_4 = longdeathtracker( var_3 );
        var_4 thread _id_1314F( undefined, var_1.radius, var_1.mp_emporium_hanging_crates );
    }
    else
        var_3 = _id_12278( "plague", var_1.origin, var_1.radius );

    level waittill( "game_ended" );
    var_4 = longdeathtracker( var_3 );

    if ( isdefined( var_4 ) )
        var_4 _id_13148();
}

player_respawn( var_0, var_1, var_2, var_3, var_4, var_5 )
{
    if ( !isdefined( level.chopperexfil_sh050_start.spawn_rpgs_for_players ) )
        level.chopperexfil_sh050_start.spawn_rpgs_for_players = [];

    if ( isdefined( level.chopperexfil_sh050_start.spawn_rpgs_for_players[var_0] ) )
        return;

    if ( !isdefined( var_1 ) )
        var_1 = ( 0, 0, 0 );

    if ( !isdefined( var_2 ) )
        var_2 = -1;

    if ( !isdefined( var_3 ) )
        var_3 = 0;

    if ( !isdefined( var_4 ) )
        var_4 = 0;

    if ( !isdefined( var_5 ) )
        var_5 = 0;

    switch ( var_0 )
    {
        case "dam":
            [var_1, var_2, var_3, var_4, var_5] = [ ( -21543, 47479, 0 ), 10000, 75, 5, 10 ];
            break;
        case "stadium":
            [var_1, var_2, var_3, var_4, var_5] = [ ( 28696, 2288, 0 ), 10000, 75, 5, 10 ];
            break;
        case "hospital":
            [var_1, var_2, var_3, var_4, var_5] = [ ( 9443, -11877, 0 ), 10000, 75, 5, 10 ];
            break;
        case "ship":
            [var_1, var_2, var_3, var_4, var_5] = [ ( 38750, -43340, 0 ), 10000, 75, 5, 10 ];
            break;
        case "tv":
            [var_1, var_2, var_3, var_4, var_5] = [ ( 15258, 17988, 0 ), 10000, 75, 5, 10 ];
            break;
        case "super":
            [var_1, var_2, var_3, var_4, var_5] = [ ( -13027, 9242, 0 ), 10000, 75, 5, 10 ];
            break;
        case "gulag":
            [var_1, var_2, var_3, var_4, var_5] = [ ( 51158, -38213, 0 ), 10000, 75, 5, 10 ];
            break;
        case "quarry":
            [var_1, var_2, var_3, var_4, var_5] = [ ( 34267, 43134, 0 ), 10000, 75, 5, 10 ];
            break;
        case "boneyard":
            [var_1, var_2, var_3, var_4, var_5] = [ ( -27531, -10899, 0 ), 10000, 75, 5, 10 ];
            break;
        case "bank":
            [var_1, var_2, var_3, var_4, var_5] = [ ( 21767, -19846, 0 ), 10000, 75, 5, 10 ];
            break;
        default:
            break;
    }

    var_16 = spawnstruct();
    var_17 = "scr_br_plague_zone_" + var_0 + "_";
    var_16.origin = getdvarvector( var_17 + "origin", var_1 );
    var_16.radius = getdvarfloat( var_17 + "radius", var_2 ) * getdvarfloat( "scr_br_plague_zone_radius_scale", 1.0 );
    var_16.mp_emporium_hanging_crates = getdvarfloat( var_17 + "grow_time", var_3 ) * getdvarfloat( "scr_br_plague_zone_grow_time_scale", 1.0 );
    var_16.get_valid_seats = getdvarfloat( var_17 + "delay", var_4 ) * getdvarfloat( "scr_br_plague_zone_delay_scale", 1.0 );
    var_16.get_valid_starting_station_name_on_track = getdvarfloat( var_17 + "delay_max", var_5 ) * getdvarfloat( "scr_br_plague_zone_delay_max_scale", 1.0 );

    if ( var_16.radius < 0 )
        return;

    level.chopperexfil_sh050_start.spawn_rpgs_for_players[var_0] = var_16;
}

transitionac130tomovinganim( var_0 )
{
    return init_minigun_lifetime_shot_count( var_0 );
}

quickdropaddtoexisting( var_0, var_1 )
{
    if ( !isdefined( level.chopperexfil_sh050_start ) || !isdefined( level.chopperexfil_sh050_start.zones ) || !isdefined( level.chopperexfil_sh050_start.types[var_0] ) )
        return 0;

    return isdefined( level.chopperexfil_sh050_start.types[var_0]._id_12798[var_1.guid] );
}
