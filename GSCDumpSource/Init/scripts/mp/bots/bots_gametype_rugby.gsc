// IW8 GSC SOURCE
// Generated by https://github.com/xensik/gsc-tool

main()
{
    setup_callbacks();
    _id_11F13();
}

setup_callbacks()
{
    level.bot_funcs["gametype_think"] = ::check_carrier_status;
    level.bot_funcs["crate_can_use"] = ::crate_can_use;
    level.bot_funcs["know_enemies_on_start"] = undefined;
    level.bot_funcs["jugg_picked_up_cancel"] = ::cargo_truck_mg_cp_createfromstructs;
}

_id_11F13()
{
    check_for_at_set_final_wave();
    scripts\mp\bots\bots_util::bot_waittill_bots_enabled();
    var_0 = check_if_players_are_not_in_plane( [ "_allies", "_axis" ] );

    if ( var_0 )
    {
        level.protect_radius = 1200;
        level.bot_gametype_precaching_done = 1;
    }
}

check_carrier_status()
{
    self notify( "bot_rugby_think" );
    self endon( "bot_rugby_think" );
    self endon( "death_or_disconnect" );
    level endon( "game_ended" );
    self endon( "death_or_disconnect" );
    level endon( "game_ended" );

    while ( !isdefined( level.bot_gametype_precaching_done ) )
        wait 0.05;

    player_carrying_rpg();
    self botsetflag( "separation", 0 );
    self botsetflag( "grenade_objectives", 1 );
    self botsetflag( "use_obj_path_style", 1 );
    self.next_time_hunt_carrier = gettime();

    if ( !isdefined( level.next_game_update_time ) )
        level.next_game_update_time = gettime() + 100;

    for (;;)
    {
        wait 0.05;

        if ( gettime() >= level.next_game_update_time )
            level.next_game_update_time = gettime() + 100;

        if ( self.health <= 0 )
            continue;

        if ( !isdefined( level._id_11BB8 ) )
        {
            if ( scripts\mp\bots\bots_strategy::bot_has_tactical_goal( "seek_rugby_jugg", undefined ) == 0 )
            {
                var_0 = ::_id_11BB3;
                var_1 = spawnstruct();
                var_1.object = level.rugby.activejuggcrates[0];
                var_1.script_goal_radius = 16;
                var_1.should_abort = level.bot_funcs["jugg_picked_up_cancel"];
                var_1.action_thread = var_0;
                var_2 = getclosestpointonnavmesh( level.rugby.activejuggcrates[0].origin, self );
                scripts\mp\bots\bots_strategy::bot_new_tactical_goal( "seek_rugby_jugg", var_2, 99, var_1 );
            }

            continue;
        }

        if ( self == level._id_11BB8 )
        {
            if ( istrue( game["switchedsides"] ) )
                var_3 = level.rugby.endzones[self.team][0];
            else
                var_3 = level.rugby.endzones[scripts\engine\utility::get_enemy_team( self.team )][0];

            var_4 = lb_impulse_dmg_threshold_low( var_3.trigger );
            self botsetscriptgoal( var_4.origin, 0, "critical", var_4.angles[1] );
            var_5 = scripts\mp\bots\bots_util::bot_waittill_goal_or_fail();
            continue;
        }

        if ( level._id_11BB8.team == self.team )
        {
            if ( !scripts\mp\bots\bots_util::bot_is_defending() )
                scripts\mp\bots\bots_strategy::bot_guard_player( level._id_11BB8, 400 );

            continue;
        }

        if ( gettime() > self.next_time_hunt_carrier || sighttracepassed( self.origin + ( 0, 0, 77 ), level._id_11BB8.origin + ( 0, 0, 77 ), 0, self ) )
        {
            self botsetscriptgoal( level._id_11BB8.origin, 16, "hunt" );
            self.next_time_hunt_carrier = gettime() + randomintrange( 4500, 5500 );
        }
    }
}

lb_impulse_dmg_threshold_low( var_0 )
{
    if ( var_0.bottargets.size >= 2 )
    {
        var_1 = scripts\engine\utility::array_randomize( var_0.bottargets );
        return var_1[0];
    }
    else
        return var_0.bottargets[0];
}

cargo_truck_mg_cp_createfromstructs( var_0 )
{
    if ( isdefined( level._id_11BB8 ) )
        return 1;

    return 0;
}

_id_11BB3( var_0 )
{
    var_1 = register_vehicle_spawners( scripts\mp\gametypes\rugby.gsc::maphint_keypadscriptableused() + 2, "jugg_captured", randomint( 100 ) > 50 );
    self botclearscriptgoal();

    if ( var_1 )
        return;

    return;
}

register_vehicle_spawners( var_0, var_1, var_2, var_3 )
{
    var_4 = 0;

    if ( self botgetdifficultysetting( "strategyLevel" ) == 1 )
        var_4 = 40;
    else if ( self botgetdifficultysetting( "strategyLevel" ) >= 2 )
        var_4 = 80;

    if ( randomint( 100 ) < var_4 && !( isdefined( var_3 ) && var_3 ) )
    {
        self botsetstance( "prone" );
        wait 0.2;
    }

    if ( self botgetdifficultysetting( "strategyLevel" ) > 0 && !var_2 )
    {

    }

    self botpressbutton( "use", var_0 );
    var_5 = scripts\mp\bots\bots_util::bot_usebutton_wait( var_0, var_1, "use_interrupted" );
    self botsetstance( "none" );
    self botclearbutton( "use" );
    var_6 = var_5 == var_1;
    return var_6;
}

_id_12E83( var_0 )
{
    var_1 = gettime();
    var_2 = var_1 + var_0 * 1000;
    wait 0.05;

    while ( self usebuttonpressed() && gettime() < var_2 && level.bombplanted )
        wait 0.05;
}

populate_bomb_wires_to_cut()
{
    return scripts\mp\bots\bots_util::bot_is_protecting();
}

player_carrying_rpg()
{
    if ( isdefined( level.bots_gametype_initialized ) && level.bots_gametype_initialized )
        return;

    level.bots_gametype_initialized = 1;
}

check_for_at_set_final_wave()
{
    wait 1.0;
    check_dropped_locations_and_offset( level.rugby.endzones["allies"][0].trigger );
    check_dropped_locations_and_offset( level.rugby.endzones["axis"][0].trigger );
    level.bot_set_objective_bottargets = 1;
}

check_dropped_locations_and_offset( var_0 )
{
    if ( !isdefined( var_0.bottargets ) )
        var_0.bottargets = scripts\mp\bots\bots_gametype_common.gsc::bot_get_valid_nodes_in_trigger( var_0 );
}

_id_12AB2()
{
    if ( !level.bombplanted )
    {
        if ( isdefined( level._id_12673 ) )
        {
            level._id_12673 = undefined;
            level.callprecisionairstrikeonlocation = undefined;
        }

        var_0 = level.callprecisionairstrikeonlocation;
        level.callprecisionairstrikeonlocation = undefined;

        foreach ( var_2 in level.participants )
        {
            if ( isalive( var_2 ) && var_2.isbombcarrier )
                level.callprecisionairstrikeonlocation = var_2;
        }

        var_4 = 0;

        if ( !isdefined( var_0 ) && isdefined( level.callprecisionairstrikeonlocation ) )
        {
            var_4 = 1;

            if ( isai( level.callprecisionairstrikeonlocation ) )
                level.callprecisionairstrikeonlocation thread canseesafecircleui();
        }
        else if ( isdefined( var_0 ) && !isdefined( level.callprecisionairstrikeonlocation ) )
            var_4 = 1;

        if ( var_4 )
        {
            foreach ( var_2 in level.participants )
            {
                if ( scripts\mp\utility\entity::isaiteamparticipant( var_2 ) )
                    var_2 scripts\mp\bots\bots_strategy::bot_defend_stop();
            }

            return;
        }
    }
    else
    {
        if ( isdefined( level.bombowner ) && !isdefined( level._id_12673 ) )
        {
            level._id_12673 = level.bombowner.team;
            level.reset_restock_flag = gettime();
        }

        if ( !isdefined( level.bomb_defuser ) || !isalive( level.bomb_defuser ) || gettime() > level.reset_restock_flag + 1000 )
        {
            var_7 = [];

            foreach ( var_2 in level.participants )
            {
                if ( isalive( var_2 ) && scripts\mp\utility\entity::isaiteamparticipant( var_2 ) && var_2.team != level._id_12673 )
                    var_7[var_7.size] = var_2;
            }

            if ( var_7.size > 0 )
            {
                var_10 = level.objectives[scripts\engine\utility::get_enemy_team( level._id_12673 )];
                var_11 = scripts\engine\utility::get_array_of_closest( var_10.curorigin, var_7 );

                if ( !isdefined( level.bomb_defuser ) || level.bomb_defuser != var_11[0] )
                {
                    var_12 = level.bomb_defuser;
                    level.bomb_defuser = var_11[0];
                    level.bomb_defuser scripts\mp\bots\bots_strategy::bot_defend_stop();

                    if ( isdefined( var_12 ) )
                        var_12 notify( "no_longer_bomb_defuser" );
                }
            }
        }
    }
}

canseesafecircleui()
{
    self endon( "death_or_disconnect" );
    level endon( "game_ended" );

    while ( !level.bombplanted && self.isbombcarrier )
    {
        var_0 = [];

        foreach ( var_2 in level.participants )
        {
            if ( isalive( var_2 ) && scripts\mp\utility\entity::isaiteamparticipant( var_2 ) && var_2.team == self.team && var_2 scripts\mp\bots\bots_util::bot_is_defending() )
                var_0[var_0.size] = var_2;
        }

        var_4 = 0;

        foreach ( var_6 in var_0 )
        {
            var_7 = distancesquared( self.origin, var_6.origin );
            var_8 = var_6.bot_defending_radius * var_6.bot_defending_radius;
            var_9 = var_6.bot_defending_radius * 2 * ( var_6.bot_defending_radius * 2 );

            if ( var_7 > var_8 && var_7 < var_9 )
                var_4++;
        }

        self setmovespeedscale( 1.0 - 0.15 * var_4 );
        wait 1;
    }
}

crate_can_use( var_0 )
{
    if ( isagent( self ) && !isdefined( var_0.boxtype ) )
        return 0;

    if ( isdefined( var_0.cratetype ) && !scripts\mp\bots\bots_killstreaks::bot_is_killstreak_supported( var_0.cratetype ) )
        return 0;

    if ( self.isbombcarrier )
        return 0;

    if ( !scripts\mp\bots\bots_util::bot_is_defending() && !scripts\mp\bots\bots_util::bot_is_protecting() && !scripts\mp\bots\bots_util::bot_is_bodyguarding() )
        return 1;

    return 0;
}

check_if_players_are_not_in_plane( var_0 )
{
    var_1 = 0;

    foreach ( var_3 in level.rugby.endzones )
    {

    }

    if ( !var_1 )
        cargo_truck_mg_enterstart();

    return !var_1;
}

cargo_truck_mg_enterstart()
{
    var_0 = [];
    var_1 = [];
    var_2 = 0;

    foreach ( var_4 in level.rugby.endzones )
    {
        var_0[var_2] = scripts\engine\utility::random( var_4[0].trigger.bottargets ).origin;
        var_1[var_2] = "zone" + var_4[0].trigger.objectivekey;
        var_2++;
    }

    scripts\mp\bots\bots_gametype_common.gsc::bot_cache_entrances( var_0, var_1 );
}
